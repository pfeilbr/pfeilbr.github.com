<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0"
    xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>azure-functions on Brian Pfeil</title>
        <link>https://brianpfeil.com/tags/azure-functions/</link>
        <description>Recent content in azure-functions on Brian Pfeil</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Mon, 25 Jan 2021 00:00:00 -0500</lastBuildDate><atom:link href="https://brianpfeil.com/tags/azure-functions/index.xml" rel="self" type="application/rss+xml" />
    <item>
<title>Azure Functions</title>
<link>https://brianpfeil.com/post/azure-functions/</link>
<pubDate>Mon, 25 Jan 2021 00:00:00 -0500</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-functions/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-functions-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-functions-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions&#34;&gt;azure functions&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Following is based on &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-node?tabs=azure-cli%2Cbrowser&#34;&gt;Create a JavaScript function from the command line - Azure Functions&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# create nodejs function project&lt;/span&gt;
func init LocalFunctionProj --javascript

&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; LocalFunctionProj

&lt;span class=&#34;c1&#34;&gt;# create new function trigger via http request&lt;/span&gt;
func new --name HttpExample --template &lt;span class=&#34;s2&#34;&gt;&amp;#34;HTTP trigger&amp;#34;&lt;/span&gt; --authlevel &lt;span class=&#34;s2&#34;&gt;&amp;#34;anonymous&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# start locally&lt;/span&gt;
func start

&lt;span class=&#34;c1&#34;&gt;# make request against local endpoint&lt;/span&gt;
curl http://localhost:7071/api/HttpExample?name&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Brian

&lt;span class=&#34;c1&#34;&gt;# create resource group&lt;/span&gt;
az group create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create storage account&lt;/span&gt;
az storage account create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmystorage01&amp;#34;&lt;/span&gt; --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --sku &lt;span class=&#34;s2&#34;&gt;&amp;#34;Standard_LRS&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create function app in azure&lt;/span&gt;
az functionapp create --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --consumption-plan-location &lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt; --runtime &lt;span class=&#34;s2&#34;&gt;&amp;#34;node&amp;#34;&lt;/span&gt; --runtime-version &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt; --functions-version &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt; --storage-account &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmystorage01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# deploy&lt;/span&gt;
func azure functionapp publish &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# invoke function on azure&lt;/span&gt;
curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://brianpfeilmyfn01.azurewebsites.net/api/httpexample?name=Brianv2&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# view near real-time streaming logs&lt;/span&gt;
func azure functionapp logstream &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# fetch the app settings.  this populates them in `local.settings.json`&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# credentials for the storage account are stored in the `AzureWebJobsStorage` property&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# this is needed to store message in storage queue&lt;/span&gt;
func azure functionapp fetch-app-settings &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# Show settings for a function app. (autogenerated)&lt;/span&gt;
az functionapp config appsettings list --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Update a function app&amp;#39;s settings. (autogenerated)&lt;/span&gt;
az functionapp config appsettings &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --settings &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureWebJobsStorage=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$storageConnectionString&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list available function templates for javascript&lt;/span&gt;
func templates list -l javascript

&lt;span class=&#34;c1&#34;&gt;# create new function using &amp;#34;Durable Functions HTTP starter&amp;#34; template&lt;/span&gt;
func new -t &lt;span class=&#34;s2&#34;&gt;&amp;#34;Durable Functions HTTP starter&amp;#34;&lt;/span&gt; -l javascript -n DurableFunctionsHTTPstarter

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;screenshots&#34;&gt;Screenshots&lt;/h2&gt;
&lt;p&gt;message(s) in the azure storage queue&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAF4oT5-alVJf4FWuRgwVkGfjNm54yVrwBQB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Managed Identity for Function in Azure Console&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAGjYBDl3URJ5JbtST8xTEQgGbSTSlwrGWoB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;notes&#34;&gt;Notes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;app settings can be access via environment variables.  See &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings?tabs=azurecli#settings&#34;&gt;Configure function app settings in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Use &lt;a href=&#34;https://azure.microsoft.com/en-us/updates/general-availability-of-key-vault-references-in-app-service-and-azure-functions/&#34;&gt;Key Vault references&lt;/a&gt; to store secrets stored in Key Vault.  They are automatically fetched and provided as environment variables to your function.
&lt;ul&gt;
&lt;li&gt;see &lt;a href=&#34;https://zimmergren.net/azure-functions-key-vault-reference-azurewebjobsstorage/&#34;&gt;Secure App Settings variables in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;e.g. App Settings Value KeyVault Reference &lt;code&gt;@Microsoft.KeyVault(SecretUri=https://pfeilkeyvault01.vault.azure.net/secrets/secret01/e0fca4271fb243178a0a861d8e6fbc59)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Functions have in/out &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp&#34;&gt;bindings&lt;/a&gt; defined in &lt;a href=&#34;LocalFunctionProj/HttpExample/function.json&#34;&gt;&lt;code&gt;function.json&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;To access other azure resources/services from a function, you configure a &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity?tabs=dotnet&#34;&gt;managed identity&lt;/a&gt; on the function app and provide access to Azure resources for that identity using Azure role-based access control.  See &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities&#34;&gt;Azure Services that support managed identities - Azure AD&lt;/a&gt;.
&lt;ul&gt;
&lt;li&gt;system-assigned managed identity - identity tied to and managed by a specific service.  when that service instance is deleted, the identity is deleted with it.&lt;/li&gt;
&lt;li&gt;user-assigned managed identity - not owned by a specific service.  lifecycle is fully managed by you.  can be assigned to multiple services.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/durable/&#34;&gt;Azure Durable Functions documentation&lt;/a&gt; - lets you write stateful functions in a serverless compute environment.  Similar to AWS Step Functions, but implemented as language level library.&lt;/li&gt;
&lt;li&gt;shared access signature (SAS) URLs for granting limited access.  Similar to S3 signed URLs.  See &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview&#34;&gt;Grant limited access to data with shared access signatures (SAS) - Azure Storage&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;A shared access signature is a signed URI that points to one or more storage resources. The URI includes a token that contains a special set of query parameters. The token indicates how the resources may be accessed by the client. One of the query parameters, the signature, is constructed from the SAS parameters and signed with the key that was used to create the SAS. This signature is used by Azure Storage to authorize access to the storage resource.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;resources&#34;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp&#34;&gt;Triggers and bindings in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-node?tabs=azure-cli%2Cbrowser&#34;&gt;Create a JavaScript function from the command line - Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale&#34;&gt;Azure Functions scale and hosting&lt;/a&gt; - covers limits and constraints&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/samples/azure-samples/functions-storage-managed-identity/using-managed-identity-between-azure-functions-and-azure-storage/&#34;&gt;Using Managed Identity between Azure Functions and Azure Storage - Code Samples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity&#34;&gt;How to use managed identities for App Service and Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings?tabs=azurecli#settings&#34;&gt;Configure function app settings in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zimmergren.net/azure-functions-key-vault-reference-azurewebjobsstorage/&#34;&gt;Secure App Settings variables in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/app-service/app-service-key-vault-references#source-application-settings-from-key-vault&#34;&gt;Source Application Settings from Key Vault&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
</item>
    
  </channel>
</rss>