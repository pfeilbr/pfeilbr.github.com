<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0"
    xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>azure on Brian Pfeil</title>
        <link>https://brianpfeil.com/tags/azure/</link>
        <description>Recent content in azure on Brian Pfeil</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Fri, 05 Feb 2021 00:00:00 -0500</lastBuildDate><atom:link href="https://brianpfeil.com/tags/azure/index.xml" rel="self" type="application/rss+xml" />
    <item>
<title>Azure Durable Functions</title>
<link>https://brianpfeil.com/post/azure-durable-functions/</link>
<pubDate>Fri, 05 Feb 2021 00:00:00 -0500</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-durable-functions/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-durable-functions-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-durable-functions-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn Azure &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/durable/&#34;&gt;Durable Functions&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;running&#34;&gt;Running&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;nv&#34;&gt;LOCATION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eastus
&lt;span class=&#34;nv&#34;&gt;BASE_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;durable-fns-playground-01
&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;BASE_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;STORAGE_ACCOUNT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BASE_NAME&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sed -e &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/-//g&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BASE_NAME&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sed -e &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/-//g&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create resource group&lt;/span&gt;
az group create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;LOCATION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create storage account&lt;/span&gt;
az storage account create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;STORAGE_ACCOUNT&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;LOCATION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --sku &lt;span class=&#34;s2&#34;&gt;&amp;#34;Standard_LRS&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create function app in azure&lt;/span&gt;
az functionapp create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --consumption-plan-location &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;LOCATION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --runtime &lt;span class=&#34;s2&#34;&gt;&amp;#34;node&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --runtime-version &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --functions-version &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --storage-account &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;STORAGE_ACCOUNT&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create functions&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# DurableFunctionsHTTPstarter is HTTP endpoint that invokes DurableFunctionsOrchestrator&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# which then calls DurableFunctionsActivity multiple time with different parameters&lt;/span&gt;

func new -t &lt;span class=&#34;s2&#34;&gt;&amp;#34;Durable Functions HTTP starter&amp;#34;&lt;/span&gt; -l javascript -n DurableFunctionsHTTPstarter
func new -t &lt;span class=&#34;s2&#34;&gt;&amp;#34;Durable Functions orchestrator&amp;#34;&lt;/span&gt; -l javascript -n DurableFunctionsOrchestrator
func new -t &lt;span class=&#34;s2&#34;&gt;&amp;#34;Durable Functions activity&amp;#34;&lt;/span&gt; -l javascript -n DurableFunctionsActivity

&lt;span class=&#34;c1&#34;&gt;# deploy&lt;/span&gt;
func azure functionapp publish &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# get function all base URL&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP_URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;az functionapp show -g &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -n &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; --query defaultHostName -o tsv&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/api&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# pull down app settings for running locally&lt;/span&gt;
func azure functionapp fetch-app-settings &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# run locally&lt;/span&gt;
func start

&lt;span class=&#34;c1&#34;&gt;# trigger durable function&lt;/span&gt;
curl &lt;span class=&#34;s1&#34;&gt;&amp;#39;http://localhost:7071/api/orchestrators/DurableFunctionsOrchestrator&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# async execution - output&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;id&amp;#34;: &amp;#34;20f2ddc1e34543379efc49a09962dfc5&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;statusQueryGetUri&amp;#34;: &amp;#34;http://localhost:7071/runtime/webhooks/durabletask/instances/20f2ddc1e34543379efc49a09962dfc5?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;sendEventPostUri&amp;#34;: &amp;#34;http://localhost:7071/runtime/webhooks/durabletask/instances/20f2ddc1e34543379efc49a09962dfc5/raiseEvent/{eventName}?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;terminatePostUri&amp;#34;: &amp;#34;http://localhost:7071/runtime/webhooks/durabletask/instances/20f2ddc1e34543379efc49a09962dfc5/terminate?reason={text}&amp;amp;taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;rewindPostUri&amp;#34;: &amp;#34;http://localhost:7071/runtime/webhooks/durabletask/instances/20f2ddc1e34543379efc49a09962dfc5/rewind?reason={text}&amp;amp;taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;purgeHistoryDeleteUri&amp;#34;: &amp;#34;http://localhost:7071/runtime/webhooks/durabletask/instances/20f2ddc1e34543379efc49a09962dfc5?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# }&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# fetch `statusQueryGetUri`&lt;/span&gt;
curl &lt;span class=&#34;s1&#34;&gt;&amp;#39;http://localhost:7071/runtime/webhooks/durabletask/instances/20f2ddc1e34543379efc49a09962dfc5?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;name&amp;#34;: &amp;#34;DurableFunctionsOrchestrator&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;instanceId&amp;#34;: &amp;#34;20f2ddc1e34543379efc49a09962dfc5&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;runtimeStatus&amp;#34;: &amp;#34;Completed&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;input&amp;#34;: null,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;customStatus&amp;#34;: null,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;output&amp;#34;: [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         &amp;#34;Hello Tokyo!&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         &amp;#34;Hello Seattle!&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         &amp;#34;Hello London!&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     ],&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;createdTime&amp;#34;: &amp;#34;2021-02-04T21:33:29Z&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;lastUpdatedTime&amp;#34;: &amp;#34;2021-02-04T21:33:30Z&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# }&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ---&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# start in own terminal&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Show interactive streaming logs for an Azure-hosted Function App&lt;/span&gt;
func azure functionapp logstream &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# trigger durable function&lt;/span&gt;
curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;FUNCTION_APP_URL&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/orchestrators/DurableFunctionsOrchestrator?code=CODE&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# async execution - output&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;id&amp;#34;: &amp;#34;7501819801f942ebaed9289e87420cbd&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;statusQueryGetUri&amp;#34;: &amp;#34;https://durablefnsplayground01.azurewebsites.net/runtime/webhooks/durabletask/instances/7501819801f942ebaed9289e87420cbd?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;sendEventPostUri&amp;#34;: &amp;#34;https://durablefnsplayground01.azurewebsites.net/runtime/webhooks/durabletask/instances/7501819801f942ebaed9289e87420cbd/raiseEvent/{eventName}?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;terminatePostUri&amp;#34;: &amp;#34;https://durablefnsplayground01.azurewebsites.net/runtime/webhooks/durabletask/instances/7501819801f942ebaed9289e87420cbd/terminate?reason={text}&amp;amp;taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;rewindPostUri&amp;#34;: &amp;#34;https://durablefnsplayground01.azurewebsites.net/runtime/webhooks/durabletask/instances/7501819801f942ebaed9289e87420cbd/rewind?reason={text}&amp;amp;taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;purgeHistoryDeleteUri&amp;#34;: &amp;#34;https://durablefnsplayground01.azurewebsites.net/runtime/webhooks/durabletask/instances/7501819801f942ebaed9289e87420cbd?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# }&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# fetch `statusQueryGetUri`&lt;/span&gt;
curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://durablefnsplayground01.azurewebsites.net/runtime/webhooks/durabletask/instances/7501819801f942ebaed9289e87420cbd?taskHub=DurableFunctionsHub&amp;amp;connection=Storage&amp;amp;code=CODE&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;name&amp;#34;: &amp;#34;DurableFunctionsOrchestrator&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;instanceId&amp;#34;: &amp;#34;7501819801f942ebaed9289e87420cbd&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;runtimeStatus&amp;#34;: &amp;#34;Completed&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;input&amp;#34;: null,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;customStatus&amp;#34;: null,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;output&amp;#34;: [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         &amp;#34;Hello Tokyo!&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         &amp;#34;Hello Seattle!&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         &amp;#34;Hello London!&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     ],&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;createdTime&amp;#34;: &amp;#34;2021-02-04T20:55:25Z&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     &amp;#34;lastUpdatedTime&amp;#34;: &amp;#34;2021-02-04T20:55:26Z&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# }&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# query function logs&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; -r -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt; QUERY &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOM
&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;traces
&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;| project timestamp, message
&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;| where timestamp &amp;gt; ago(24h)
&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;| limit 10
&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;EOM&lt;/span&gt;

az monitor app-insights query &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --app &lt;span class=&#34;s1&#34;&gt;&amp;#39;cd03d419-0bba-410e-ac3f-d7e934c027f1&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --analytics-query &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;tables&amp;#34;: [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#     {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#       &amp;#34;columns&amp;#34;: [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;name&amp;#34;: &amp;#34;timestamp&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;type&amp;#34;: &amp;#34;datetime&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         },&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;name&amp;#34;: &amp;#34;message&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         }&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#       ],&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#       &amp;#34;name&amp;#34;: &amp;#34;PrimaryResult&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#       &amp;#34;rows&amp;#34;: [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;2021-02-04T20:56:04.3256227Z&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;Host Status: {\r\n  \&amp;#34;id\&amp;#34;: \&amp;#34;durablefnsplayground01\&amp;#34;,\r\n  \&amp;#34;state\&amp;#34;: \&amp;#34;Running\&amp;#34;,\r\n  \&amp;#34;version\&amp;#34;: \&amp;#34;3.0.15193.0\&amp;#34;,\r\n  \&amp;#34;versionDetails\&amp;#34;: \&amp;#34;3.0.15193 Commit hash: 75da1ebed23b08b39c8c3c20b3ea687813c0acdf\&amp;#34;,\r\n  \&amp;#34;platformVersion\&amp;#34;: \&amp;#34;91.0.7.116\&amp;#34;,\r\n  \&amp;#34;instanceId\&amp;#34;: \&amp;#34;00d386aeb51a3d5098651c58f61ffb53a9b1a656ea9e9b0dd570b9834cdc3d4f\&amp;#34;,\r\n  \&amp;#34;computerName\&amp;#34;: \&amp;#34;DW0-HR0-3-17\&amp;#34;,\r\n  \&amp;#34;processUptime\&amp;#34;: 145740,\r\n  \&amp;#34;extensionBundle\&amp;#34;: {\r\n    \&amp;#34;id\&amp;#34;: \&amp;#34;Microsoft.Azure.Functions.ExtensionBundle\&amp;#34;,\r\n    \&amp;#34;version\&amp;#34;: \&amp;#34;1.5.0\&amp;#34;\r\n  }\r\n}&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         ],&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         [&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;2021-02-04T20:56:05.4099623Z&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#           &amp;#34;Host Status: {\r\n  \&amp;#34;id\&amp;#34;: \&amp;#34;durablefnsplayground01\&amp;#34;,\r\n  \&amp;#34;state\&amp;#34;: \&amp;#34;Running\&amp;#34;,\r\n  \&amp;#34;version\&amp;#34;: \&amp;#34;3.0.15193.0\&amp;#34;,\r\n  \&amp;#34;versionDetails\&amp;#34;: \&amp;#34;3.0.15193 Commit hash: 75da1ebed23b08b39c8c3c20b3ea687813c0acdf\&amp;#34;,\r\n  \&amp;#34;platformVersion\&amp;#34;: \&amp;#34;91.0.7.116\&amp;#34;,\r\n  \&amp;#34;instanceId\&amp;#34;: \&amp;#34;00d386aeb51a3d5098651c58f61ffb53a9b1a656ea9e9b0dd570b9834cdc3d4f\&amp;#34;,\r\n  \&amp;#34;computerName\&amp;#34;: \&amp;#34;DW0-HR0-3-17\&amp;#34;,\r\n  \&amp;#34;processUptime\&amp;#34;: 146826,\r\n  \&amp;#34;extensionBundle\&amp;#34;: {\r\n    \&amp;#34;id\&amp;#34;: \&amp;#34;Microsoft.Azure.Functions.ExtensionBundle\&amp;#34;,\r\n    \&amp;#34;version\&amp;#34;: \&amp;#34;1.5.0\&amp;#34;\r\n  }\r\n}&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         ],&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#         ...&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;resources&#34;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/durable/&#34;&gt;Azure Durable Functions documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
</item>
    
    <item>
<title>Azure ARM</title>
<link>https://brianpfeil.com/post/azure-arm/</link>
<pubDate>Fri, 29 Jan 2021 00:00:00 -0500</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-arm/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-arm-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-arm-playground&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;armplayground01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create resource group&lt;/span&gt;
az group create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; --location eastus

&lt;span class=&#34;c1&#34;&gt;# deploy arm outputs example&lt;/span&gt;
az deployment group create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-deployment-01&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;RESOURCE_GROUP_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --template-file &lt;span class=&#34;s2&#34;&gt;&amp;#34;templates/outputs.azuredeploy.json&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --parameters @templates/outputs.parameters.json

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
</item>
    
    <item>
<title>Azure Functions</title>
<link>https://brianpfeil.com/post/azure-functions/</link>
<pubDate>Mon, 25 Jan 2021 00:00:00 -0500</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-functions/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-functions-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-functions-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions&#34;&gt;azure functions&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Following is based on &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-node?tabs=azure-cli%2Cbrowser&#34;&gt;Create a JavaScript function from the command line - Azure Functions&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# create nodejs function project&lt;/span&gt;
func init LocalFunctionProj --javascript

&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; LocalFunctionProj

&lt;span class=&#34;c1&#34;&gt;# create new function trigger via http request&lt;/span&gt;
func new --name HttpExample --template &lt;span class=&#34;s2&#34;&gt;&amp;#34;HTTP trigger&amp;#34;&lt;/span&gt; --authlevel &lt;span class=&#34;s2&#34;&gt;&amp;#34;anonymous&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# start locally&lt;/span&gt;
func start

&lt;span class=&#34;c1&#34;&gt;# make request against local endpoint&lt;/span&gt;
curl http://localhost:7071/api/HttpExample?name&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Brian

&lt;span class=&#34;c1&#34;&gt;# create resource group&lt;/span&gt;
az group create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create storage account&lt;/span&gt;
az storage account create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmystorage01&amp;#34;&lt;/span&gt; --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --sku &lt;span class=&#34;s2&#34;&gt;&amp;#34;Standard_LRS&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create function app in azure&lt;/span&gt;
az functionapp create --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --consumption-plan-location &lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt; --runtime &lt;span class=&#34;s2&#34;&gt;&amp;#34;node&amp;#34;&lt;/span&gt; --runtime-version &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt; --functions-version &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt; --storage-account &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmystorage01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# deploy&lt;/span&gt;
func azure functionapp publish &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# invoke function on azure&lt;/span&gt;
curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://brianpfeilmyfn01.azurewebsites.net/api/httpexample?name=Brianv2&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# view near real-time streaming logs&lt;/span&gt;
func azure functionapp logstream &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# fetch the app settings.  this populates them in `local.settings.json`&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# credentials for the storage account are stored in the `AzureWebJobsStorage` property&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# this is needed to store message in storage queue&lt;/span&gt;
func azure functionapp fetch-app-settings &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# Show settings for a function app. (autogenerated)&lt;/span&gt;
az functionapp config appsettings list --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Update a function app&amp;#39;s settings. (autogenerated)&lt;/span&gt;
az functionapp config appsettings &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;brianpfeilmyfn01&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureFunctionsQuickstart-rg&amp;#34;&lt;/span&gt; --settings &lt;span class=&#34;s2&#34;&gt;&amp;#34;AzureWebJobsStorage=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$storageConnectionString&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list available function templates for javascript&lt;/span&gt;
func templates list -l javascript

&lt;span class=&#34;c1&#34;&gt;# create new function using &amp;#34;Durable Functions HTTP starter&amp;#34; template&lt;/span&gt;
func new -t &lt;span class=&#34;s2&#34;&gt;&amp;#34;Durable Functions HTTP starter&amp;#34;&lt;/span&gt; -l javascript -n DurableFunctionsHTTPstarter

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;screenshots&#34;&gt;Screenshots&lt;/h2&gt;
&lt;p&gt;message(s) in the azure storage queue&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAF4oT5-alVJf4FWuRgwVkGfjNm54yVrwBQB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Managed Identity for Function in Azure Console&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAGjYBDl3URJ5JbtST8xTEQgGbSTSlwrGWoB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;notes&#34;&gt;Notes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;app settings can be access via environment variables.  See &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings?tabs=azurecli#settings&#34;&gt;Configure function app settings in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Use &lt;a href=&#34;https://azure.microsoft.com/en-us/updates/general-availability-of-key-vault-references-in-app-service-and-azure-functions/&#34;&gt;Key Vault references&lt;/a&gt; to store secrets stored in Key Vault.  They are automatically fetched and provided as environment variables to your function.
&lt;ul&gt;
&lt;li&gt;see &lt;a href=&#34;https://zimmergren.net/azure-functions-key-vault-reference-azurewebjobsstorage/&#34;&gt;Secure App Settings variables in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;e.g. App Settings Value KeyVault Reference &lt;code&gt;@Microsoft.KeyVault(SecretUri=https://pfeilkeyvault01.vault.azure.net/secrets/secret01/e0fca4271fb243178a0a861d8e6fbc59)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Functions have in/out &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp&#34;&gt;bindings&lt;/a&gt; defined in &lt;a href=&#34;LocalFunctionProj/HttpExample/function.json&#34;&gt;&lt;code&gt;function.json&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;To access other azure resources/services from a function, you configure a &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity?tabs=dotnet&#34;&gt;managed identity&lt;/a&gt; on the function app and provide access to Azure resources for that identity using Azure role-based access control.  See &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities&#34;&gt;Azure Services that support managed identities - Azure AD&lt;/a&gt;.
&lt;ul&gt;
&lt;li&gt;system-assigned managed identity - identity tied to and managed by a specific service.  when that service instance is deleted, the identity is deleted with it.&lt;/li&gt;
&lt;li&gt;user-assigned managed identity - not owned by a specific service.  lifecycle is fully managed by you.  can be assigned to multiple services.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/durable/&#34;&gt;Azure Durable Functions documentation&lt;/a&gt; - lets you write stateful functions in a serverless compute environment.  Similar to AWS Step Functions, but implemented as language level library.&lt;/li&gt;
&lt;li&gt;shared access signature (SAS) URLs for granting limited access.  Similar to S3 signed URLs.  See &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview&#34;&gt;Grant limited access to data with shared access signatures (SAS) - Azure Storage&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;A shared access signature is a signed URI that points to one or more storage resources. The URI includes a token that contains a special set of query parameters. The token indicates how the resources may be accessed by the client. One of the query parameters, the signature, is constructed from the SAS parameters and signed with the key that was used to create the SAS. This signature is used by Azure Storage to authorize access to the storage resource.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;resources&#34;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp&#34;&gt;Triggers and bindings in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-node?tabs=azure-cli%2Cbrowser&#34;&gt;Create a JavaScript function from the command line - Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale&#34;&gt;Azure Functions scale and hosting&lt;/a&gt; - covers limits and constraints&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/samples/azure-samples/functions-storage-managed-identity/using-managed-identity-between-azure-functions-and-azure-storage/&#34;&gt;Using Managed Identity between Azure Functions and Azure Storage - Code Samples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity&#34;&gt;How to use managed identities for App Service and Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings?tabs=azurecli#settings&#34;&gt;Configure function app settings in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zimmergren.net/azure-functions-key-vault-reference-azurewebjobsstorage/&#34;&gt;Secure App Settings variables in Azure Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/app-service/app-service-key-vault-references#source-application-settings-from-key-vault&#34;&gt;Source Application Settings from Key Vault&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
</item>
    
    <item>
<title>Azure Pipelines</title>
<link>https://brianpfeil.com/post/azure-pipelines/</link>
<pubDate>Wed, 26 Feb 2020 00:00:00 -0500</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-pipelines/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-pipelines-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-pipelines-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops&#34;&gt;azure pipelines&lt;/a&gt;&lt;/p&gt;
&lt;!-- TOC --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#azure-pipelines-playground&#34;&gt;azure-pipelines-playground&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#infrastructure-provisioning-steps&#34;&gt;Infrastructure Provisioning Steps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#website-content-publishing-steps&#34;&gt;Website Content Publishing Steps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#deprovisioning&#34;&gt;Deprovisioning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#architecture&#34;&gt;Architecture&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#key-files-and-directories&#34;&gt;Key Files and Directories&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#screenshots&#34;&gt;Screenshots&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#todo&#34;&gt;TODO&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#completed--cancelled&#34;&gt;Completed / Cancelled&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#notes&#34;&gt;Notes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#scratch&#34;&gt;Scratch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- /TOC --&gt;
&lt;hr&gt;
&lt;h2 id=&#34;description&#34;&gt;Description&lt;/h2&gt;
&lt;p&gt;Pipeline performs an atomic deploy of static content from a github repo to a static site (Rout53 + ACM + WAF CloudFront + S3 when) a tag (release)
is applied to the repo&lt;/p&gt;
&lt;h2 id=&#34;infrastructure-provisioning-steps&#34;&gt;Infrastructure Provisioning Steps&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;create route 53 hosted zone for your domain name (e.g. &lt;code&gt;mydomain.com&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;update &lt;code&gt;DOMAIN_NAME&lt;/code&gt; parameter in &lt;a href=&#34;scripts/stack.sh&#34;&gt;&lt;code&gt;scripts/stack.sh&lt;/code&gt;&lt;/a&gt; with the hosted zone name&lt;/li&gt;
&lt;li&gt;provision aws resources &lt;code&gt;./scripts/stack.sh create&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Check ACM to confirm Certificate validation via DNS validation has completed.  May need to add DNS validation records to route53 hosted zone.&lt;/li&gt;
&lt;li&gt;update pipeline variables
&lt;ul&gt;
&lt;li&gt;REGION - &lt;em&gt;default is us-east-1&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;STACK_NAME - defined in &lt;a href=&#34;scripts/stack.sh&#34;&gt;&lt;code&gt;scripts/stack.sh&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;AWS_ACCESS_KEY_ID - &lt;code&gt;AccessKey&lt;/code&gt; output in &lt;code&gt;./tmp/${STACK_NAME}-outputs.json&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;AWS_SECRET_ACCESS_KEY - &lt;code&gt;SecretKey&lt;/code&gt; output in &lt;code&gt;./tmp/${STACK_NAME}-outputs.json&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;website-content-publishing-steps&#34;&gt;Website Content Publishing Steps&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ensure you have &lt;code&gt;develop&lt;/code&gt; branch checked out &lt;em&gt;(this corresponds to staging environment)&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;update website content in &lt;a href=&#34;public&#34;&gt;&lt;code&gt;public&lt;/code&gt;&lt;/a&gt; directory and push to github.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;(optional)&lt;/em&gt; update redirect rules in &lt;a href=&#34;routing-rules/routing-rules.txt&#34;&gt;&lt;code&gt;routing-rules/routing-rules.txt&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;push your commit(s) to remote (github)&lt;/li&gt;
&lt;li&gt;publish will run.  can take up to 20 minutes to complete due CloudFront distribution update.&lt;/li&gt;
&lt;li&gt;verify updated content by visiting &lt;a href=&#34;https://staging.mydomain.com&#34;&gt;https://staging.mydomain.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;to publish staging to production, checkout master branch and merge in develop&lt;/li&gt;
&lt;li&gt;push your commit(s) to remote (github)&lt;/li&gt;
&lt;li&gt;verify updated content by visiting &lt;a href=&#34;https://mydomain.com&#34;&gt;https://mydomain.com&lt;/a&gt; and &lt;a href=&#34;https://www.mydomain.com&#34;&gt;https://www.mydomain.com&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;deprovisioning&#34;&gt;Deprovisioning&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;deprovision aws resources &lt;code&gt;./scripts/stack.sh delete&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;(optional)&lt;/em&gt; manually delete S3 website and CloudFront logs buckets.
&lt;blockquote&gt;
&lt;p&gt;these are not deleted because they still contain objects&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;(optional)&lt;/em&gt; run &lt;code&gt;./scripts/stack.sh delete&lt;/code&gt; again to permanently delete stack&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;architecture&#34;&gt;Architecture&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;assets/images/architecture.png&#34; alt=&#34;architecture&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;key-files-and-directories&#34;&gt;Key Files and Directories&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;cfn-templates/resources.yaml&#34;&gt;&lt;code&gt;cfn-templates/resources.yaml&lt;/code&gt;&lt;/a&gt; - CloudFormation stack for provisioning AWS resources.
&lt;ul&gt;
&lt;li&gt;S3 bucket(s) for static content (staging + production)&lt;/li&gt;
&lt;li&gt;CloudFront distribution(s) (staging + production)&lt;/li&gt;
&lt;li&gt;lambda@edge function for basic auth for staging site&lt;/li&gt;
&lt;li&gt;WAF Web ACL for CloudFront distribution(s)&lt;/li&gt;
&lt;li&gt;aws secrets manager secret (json doc) to store basic auth users&lt;/li&gt;
&lt;li&gt;S3 bucket for CloudFront access logs&lt;/li&gt;
&lt;li&gt;SSL Certificate (ACM)&lt;/li&gt;
&lt;li&gt;route53 root domain ALIAS record to CloudFront distribution&lt;/li&gt;
&lt;li&gt;route53 &lt;strong&gt;staging&lt;/strong&gt; and &lt;strong&gt;www&lt;/strong&gt; CNAME records to CloudFront distribution&lt;/li&gt;
&lt;li&gt;IAM user for CI/CD automation used by the azure pipeline&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;public&#34;&gt;&lt;code&gt;public&lt;/code&gt;&lt;/a&gt; - static web content&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;scripts/stack.sh&#34;&gt;&lt;code&gt;scripts/stack.sh&lt;/code&gt;&lt;/a&gt; - provisions AWS resources&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;tmp/automation-stack-outputs.json&#34;&gt;&lt;code&gt;tmp/automation-outputs.json&lt;/code&gt;&lt;/a&gt; - stack outputs stored here.  &lt;em&gt;file gets created when stack is provisioned.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;scripts/tag-and-trigger-publish.sh&#34;&gt;&lt;code&gt;scripts/tag-and-trigger-publish.sh&lt;/code&gt;&lt;/a&gt; - tags and pushes the tag to github to trigger the publish pipeline&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;scripts/publish.sh&#34;&gt;&lt;code&gt;scripts/publish.sh&lt;/code&gt;&lt;/a&gt; - publishes a new version of the static site based on git tag.  this is used by pipeline&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;azure-pipelines.yml&#34;&gt;&lt;code&gt;azure-pipelines.yml&lt;/code&gt;&lt;/a&gt; - pipeline definition that get triggered on tag to publish to site&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;screenshots&#34;&gt;Screenshots&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Pipeline Variables&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAHE5oOGeN9Kv7oZa-EDbz0NwbJwlITnmBkB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;todo&#34;&gt;TODO&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;route53 CNAME record to point directly to S3 bucket website domain.  used to troubleshoot/bypass cache issues.
&lt;ul&gt;
&lt;li&gt;e.g. &lt;a href=&#34;https://bucket.mysite.com&#34;&gt;https://bucket.mysite.com&lt;/a&gt; -&amp;gt; &lt;a href=&#34;https://bucket.s3-website-us-east-1.amazonaws.com&#34;&gt;https://bucket.s3-website-us-east-1.amazonaws.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;research basic auth options
&lt;ul&gt;
&lt;li&gt;ok not to have basic auth?&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;completed--cancelled&#34;&gt;Completed / Cancelled&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;add WAF ACL and associate to CF dist(s)
&lt;ul&gt;
&lt;li&gt;see &lt;a href=&#34;https://forums.aws.amazon.com/thread.jspa?messageID=936616&amp;amp;#936616&#34;&gt;Web ACL created om WAF V2 not accessible on CloudFront&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;add API origin to CF distribution for requests to /api/* path
&lt;ul&gt;
&lt;li&gt;precedence to 1, forward query strings, cookies, all all HTTP methods&lt;/li&gt;
&lt;li&gt;this is IMPORTANT &lt;strong&gt;You can indeed put CF dist in front of APIG, the trick is to force HTTPS only &amp;ldquo;Viewer Protocol Policy&amp;rdquo; AND to NOT forward the HOST header because APIG needs SNI&lt;/strong&gt;. see &lt;a href=&#34;https://stackoverflow.com/questions/32825413/how-do-you-add-cloudfront-in-front-of-api-gateway&#34;&gt;How do you add CloudFront in front of API Gateway&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://advancedweb.hu/how-to-use-api-gateway-with-cloudfront/&#34;&gt;How to use API Gateway with CloudFront&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;add staging CloudFront distribution
&lt;ul&gt;
&lt;li&gt;options
&lt;ul&gt;
&lt;li&gt;separate bucket s3://stage s3://prod&lt;/li&gt;
&lt;li&gt;single bucket with prefix s3://bucket/stage/* s3://bucket/prod/*&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;update s3 redirect/routing rules for deploy version prefix
&lt;ul&gt;
&lt;li&gt;e.g. domain.com/oldlink would point to /v0.0.1/newlink in the bucket. the &lt;code&gt;/v0.0.1&lt;/code&gt; prefix need to be updated in all redirect rules on deploy&lt;/li&gt;
&lt;li&gt;see &lt;a href=&#34;https://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-website.html&#34;&gt;https://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-website.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;more reliable method of picking the origin path to update since there are two origins&lt;/li&gt;
&lt;li&gt;create IAM policy and role for resource provisioning
&lt;ul&gt;
&lt;li&gt;look at CloudFormation | Stack | Resources view for resource types&lt;/li&gt;
&lt;li&gt;specify resource name prefix and suffix as variable to allow for change&lt;/li&gt;
&lt;li&gt;specify role-arn for cloudformation cli&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;redirects
&lt;ul&gt;
&lt;li&gt;options
&lt;ul&gt;
&lt;li&gt;via lambda@edge&lt;/li&gt;
&lt;li&gt;check if WAF supports&lt;/li&gt;
&lt;li&gt;S3 bucket routing rules (&lt;code&gt;AWS::S3::Bucket RoutingRule&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;s3 object metadata header. see &lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/dev/how-to-page-redirect.html#advanced-conditional-redirects&#34;&gt;(Optional) Configuring a Webpage Redirect&lt;/a&gt; and &lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html#RESTObjectCOPY-requests-request-headers&#34;&gt;&lt;code&gt;x-amz-website-redirect-location&lt;/code&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;If the bucket is configured as a website, redirects requests for this object to another object in the same bucket or to an external URL. Amazon S3 stores the value of this header in the object metadata.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;trailing slashes: see the following on how to handle &lt;a href=&#34;https://forums.aws.amazon.com/thread.jspa?threadID=168000#jive-message-592535&#34;&gt;Re: S3 make a non-trailing slash URL send a 301 instead of a 302&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;basic auth on staging cloudfront dist
&lt;ul&gt;
&lt;li&gt;options
&lt;ul&gt;
&lt;li&gt;lambda@edge&lt;/li&gt;
&lt;li&gt;WAF rule for Authorization header&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;update &lt;code&gt;scripts/publish.sh&lt;/code&gt; with proper cache control for index.html (no-cache)
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;aws s3 sync --cache-control &lt;span class=&#34;s1&#34;&gt;&amp;#39;max-age=604800&amp;#39;&lt;/span&gt; --exclude index.html build/ s3://mywebsitebucket/
aws s3 sync --cache-control &lt;span class=&#34;s1&#34;&gt;&amp;#39;no-cache&amp;#39;&lt;/span&gt; build/ s3://mywebsitebucket/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;deny requests directly to s3.  must use domain.  remove OAI and add this.  this will allows redirects in S3 to work.
&lt;ul&gt;
&lt;li&gt;see &lt;a href=&#34;https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-serve-static-website/&#34;&gt;How do I use CloudFront to serve a static website hosted on Amazon S3?&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;TLDR; the referer is set on the CloudFront distribution and is a secret.  the S3 bucket policy only allows requests from this referer&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/premiumsupport/knowledge-center/s3-rest-api-cloudfront-error-403/&#34;&gt;Iâ€™m using an S3 REST API endpoint as the origin of my CloudFront distribution. Why am I getting 403 Access Denied errors?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/premiumsupport/knowledge-center/s3-website-cloudfront-error-403/&#34;&gt;Iâ€™m using an S3 website endpoint as the origin of my CloudFront distribution. Why am I getting 403 Access Denied errors?&lt;/a&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2012-10-17&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;http referer policy ${DomainName}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Statement&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Sid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow get requests referred by ${DomainName}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Effect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Principal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;s3:GetObject&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Resource&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:s3:::${BUCKET}/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Condition&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;StringLike&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;aws:Referer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://${DomainName}/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://${DomainName}/*&amp;#34;&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Sid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Explicit deny to ensure requests are allowed only from specific referer.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Effect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Deny&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Principal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;s3:GetObject&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Resource&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:s3:::${BUCKET}/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;Condition&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;StringNotLike&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;aws:Referer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://${DomainName}/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://${DomainName}/*&amp;#34;&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;notes&#34;&gt;Notes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;pipeline is running in azure DevOps tied to personal gmail account&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;scratch&#34;&gt;Scratch&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# delete all remote tags&lt;/span&gt;
git tag -l &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; xargs -n &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; git push --delete origin

&lt;span class=&#34;c1&#34;&gt;# delete all local tags&lt;/span&gt;
git tag &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; xargs git tag -d

&lt;span class=&#34;c1&#34;&gt;#REDIRECT_LOCATION=&amp;#34;https://allthecloudbits.com/products/product02/&amp;#34;&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;REGION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;us-east-1&amp;#34;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;STACK_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;dev-agency-website&amp;#34;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;BUCKET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;aws cloudformation describe-stacks --region &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REGION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; --stack-name &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;STACK_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; --query &lt;span class=&#34;s2&#34;&gt;&amp;#34;Stacks[0].Outputs[?OutputKey==&amp;#39;WebsiteBucketName&amp;#39;].OutputValue&amp;#34;&lt;/span&gt; --output text&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;PREFIX&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v0.0.1&amp;#34;&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;TARGET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PREFIX&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/about&amp;#34;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;REDIRECT_LOCATION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/about/&amp;#34;&lt;/span&gt;

aws --profile automation-user s3api put-object &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --bucket &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;BUCKET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --key &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TARGET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --website-redirect-location &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;REDIRECT_LOCATION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --content-length &lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;

aws --profile automation-user s3api head-object &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --bucket &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;BUCKET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --key &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TARGET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

aws --profile automation-user s3api delete-object &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --bucket &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;BUCKET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --key &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;TARGET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;


aws --profile automation-user s3api list-objects &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --bucket &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;BUCKET&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;policy components&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Effect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Principal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:iam::529276214230:user/admin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;s3:*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Resource&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:s3:::dev-agency-website-s3bucketforwebsitecontent-11u56g1n9u9oo/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Effect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Principal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;s3:GetObject&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Resource&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:s3:::dev-agency-website-s3bucketforwebsitecontent-11u56g1n9u9oo/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Condition&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;StringLike&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;aws:Referer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;79011a81-c048-4877-84f4-efe9577d7250&amp;#34;&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Effect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Deny&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Principal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;s3:GetObject&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Resource&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:s3:::dev-agency-website-s3bucketforwebsitecontent-11u56g1n9u9oo/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;Condition&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;StringNotLike&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;aws:Referer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;79011a81-c048-4877-84f4-efe9577d7250&amp;#34;&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;create_routing_rule()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;bucket=$1&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;prefix=$2&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;target=$3&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;redirect_location=$4&lt;/span&gt;

    &lt;span class=&#34;err&#34;&gt;aws&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;s3api&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;put-object&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;--bucket&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;${bucket}&amp;#34;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;--key&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;${prefix}${target}&amp;#34;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;--website-redirect-location&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;${redirect_location}&amp;#34;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;--content-length&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;create_routing_rules()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;bucket=$1&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;prefix=$2&lt;/span&gt;

    &lt;span class=&#34;err&#34;&gt;IFS=$&amp;#39;\r\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;GLOBIGNORE=&amp;#39;*&amp;#39;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;rules=($(cat&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;routing-rules/routing-rules.txt))&lt;/span&gt; 

    &lt;span class=&#34;err&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;rule&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;${rules[@]}&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;do&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;components=($(echo&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$rule&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;tr&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\r\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;))&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;target=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;${components[1]}&amp;#34;&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;redirect_location=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;${components[2]}&amp;#34;&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;target=${target}, redirect_location=${redirect_location}&amp;#34;&lt;/span&gt;

        &lt;span class=&#34;err&#34;&gt;create_routing_rule&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;${bucket}&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;${prefix}&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;${target}&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;${redirect_location}&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;done&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;create_routing_rules&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;dev-agency-website-s3bucketforwebsitecontent-1fbv8htrn7nna&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;v0.0.1&amp;#34;&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;tag&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCHNAME=v&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCH=refs/tags/v&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSION=f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;302&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ed&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7e007&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;57&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;118&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8835&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;378&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ddd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;63e105&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSIONMESSAGE=output&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;env&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;variables&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;develop&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;branch&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCHNAME=develop&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCH=refs/heads/develop&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSION=e&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;59&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;dfea&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;bd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;88&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3808&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;46&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;48&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;da&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ddd&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;83e8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;809&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSIONMESSAGE=output&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;env&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;variables&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;pipeline&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;environment&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;variables&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;LEIN_HOME=/usr/local/lib/lein&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_QUEUEDBY=GitHub&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_HOMEDIRECTORY=/home/vsts/agents/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2.165&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;M&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_HOME=/usr/share/apache-maven&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;-3.6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BOOST_ROOT=/usr/local/share/boost/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.69&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_STAGEDISPLAYNAME=__default&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_VERSION=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2.165&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBATTEMPT=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GOROOT_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/local/go&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.11&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ANDROID_HOME=/usr/local/lib/android/sdk&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;JAVA_HOME_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/lib/jvm/zulu&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-11&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-azure-amd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TEAMFOUNDATIONSERVERURI=https://dev.azure.com/brianpfeil/&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ImageVersion=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;20200301.1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_TOOLSDIRECTORY=/opt/hostedtoolcache&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_DEFINITIONID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_DISABLELOGPLUGIN_TESTFILEPUBLISHERPLUGIN=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;LANG=C.UTF&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-8&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_WORKFOLDER=/home/vsts/work&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AZURE_EXTENSION_DIR=/opt/az/azcliextensions&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_DEFINITIONNAME=pfeilbr.azure-pipelines-playground&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_TEMPDIRECTORY=/home/vsts/work/_temp&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;INVOCATION_ID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;71&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;915879&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04391&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;20e7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2867&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21806&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;JAVA_HOME_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/lib/jvm/zulu&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-azure-amd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AWS_SECRET_ACCESS_KEY=***&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REQUESTEDFOR=Brian&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Pfeil&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PHASENAME=Job&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ANDROID_SDK_ROOT=/usr/local/lib/android/sdk&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBIDENTIFIER=Job.__default&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PULLREQUEST_ISFORK=False&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;JAVA_HOME=/usr/lib/jvm/zulu&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-azure-amd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBPARALLELISMTAG=Private&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;DOTNET_SKIP_FIRST_TIME_EXPERIENCE=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;USER=vsts&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REASON=IndividualCI&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_OS=Linux&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_ISSCHEDULED=False&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSION=f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;302&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ed&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7e007&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;57&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;118&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8835&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;378&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ddd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;63e105&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ENDPOINT_URL_SYSTEMVSSCONNECTION=https://dev.azure.com/brianpfeil/&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCH=refs/tags/v&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GRADLE_HOME=/usr/share/gradle&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_WORKFOLDER=/home/vsts/work&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_QUEUEDBYID=a&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;399e9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-ba&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17-47&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ed&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-9005-8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;263530&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;afdf&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_DISABLELOGPLUGIN_TESTRESULTLOGPLUGIN=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_ROOTDIRECTORY=/home/vsts/work&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;PWD=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/s&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ImageOS=ubuntu&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;HOME=/home/vsts&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_ID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GOROOT=/usr/local/go&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.12&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;JOURNAL_STREAM=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31906&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TOTALJOBSINPHASE=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_COLLECTIONURI=https://dev.azure.com/brianpfeil/&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;RUNNER_TOOLSDIRECTORY=/opt/hostedtoolcache&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;JAVA_HOME_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/lib/jvm/zulu&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-azure-amd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_OSARCHITECTURE=X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_CULTURE=en-US&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TEAMPROJECTID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;398&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5300-9203-4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-957&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-82&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;eedb&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;aea&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;92&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;VSTS_AGENT_PERFLOG=/home/vsts/perflog&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;CONDA=/usr/share/miniconda&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;PIPELINE_WORKSPACE=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GOROOT_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/local/go&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.13&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BOOST_ROOT_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;69&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/local/share/boost/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.69&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBPOSITIONINPHASE=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;DEBIAN_FRONTEND=noninteractive&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1170&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-54&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2-53&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3-20&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;dd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;fc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;dff&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_JOBNAME=Job&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_ACCEPTTEEEULA=True&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_STAGEATTEMPT=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PIPELINESTARTTIME=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2020-03-05&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;STACK_NAME=dev-agency-website&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_URI=https://github.com/pfeilbr/azure-pipelines-playground&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_READONLYVARIABLES=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_PROVIDER=GitHub&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TASKINSTANCENAME=CmdLine&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GOROOT_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/local/go&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.12&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GECKOWEBDRIVER=/usr/local/share/gecko_driver&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PLANID=b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cbb&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3-6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-85&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;da&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;89&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;56&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;bfcc&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_DEFINITIONVERSION=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;TASK_DISPLAYNAME=deploy&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_HOSTTYPE=build&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;CHROMEWEBDRIVER=/usr/local/share/chrome_driver&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_STAGINGDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/a&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;MSDEPLOY_HTTP_USER_AGENT=VSTS_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55890-46&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6-40&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1-9714-8220&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ddd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;bd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_build_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REQUESTEDFOREMAIL=brian.pfeil@gmail.com&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;TF_BUILD=True&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AZURE_HTTP_USER_AGENT=VSTS_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55890-46&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6-40&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1-9714-8220&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ddd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;bd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_build_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_LOCALPATH=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/s&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PHASEDISPLAYNAME=Job&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_NAME=pfeilbr/azure-pipelines-playground&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_ARTIFACTSTAGINGDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/a&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TASKDEFINITIONSURI=https://dev.azure.com/brianpfeil/&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_GIT_SUBMODULECHECKOUT=False&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSIONAUTHOR=Brian&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Pfeil&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TASKDISPLAYNAME=deploy&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_STAGENAME=__default&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;VSTS_PROCESS_LOOKUP_ID=vsts_f&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;104e61&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9-493&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-8204-4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ffeb&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8973&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;65&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_ID=pfeilbr/azure-pipelines-playground&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSIONMESSAGE=output&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;env&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;variables&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM=build&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PHASEATTEMPT=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;VCPKG_INSTALLATION_ROOT=/usr/local/share/vcpkg&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBNAME=__default&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;REGION=us-east&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_PHASEID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60-14&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7-570&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-14&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-fa&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;42&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ad&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;92&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;52&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_MACHINENAME=fv-az&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;755&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;COMMON_TESTRESULTSDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/TestResults&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;agent.jobstatus=Succeeded&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;JAVA_HOME_&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;_X&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;=/usr/lib/jvm/zulu&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-azure-amd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_DEFINITIONNAME=pfeilbr.azure-pipelines-playground&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AWS_ACCESS_KEY_ID=AKIAXWO&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;SDPLDE&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;43&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;XM&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;W&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_ARTIFACTSDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/a&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SHLVL=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REQUESTEDFORID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ba&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;760&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-cdcf&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15-8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;37&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;de&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cf&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7631&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_NAME=Hosted&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Agent&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_BUILDNUMBER=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;20200305.5&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCHNAME=v&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_JOBDISPLAYNAME=Job&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_SOURCESDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/s&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;LEIN_JAR=/usr/local/lib/lein/self-installs/leiningen&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;-2.9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-standalone.jar&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_BUILDURI=vstfs:///Build/Build/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;53&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_SERVERTYPE=Hosted&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TIMELINEID=b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cbb&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3-6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-85&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;da&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;89&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;56&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;bfcc&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_RETAINDEFAULTENCODING=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TASKINSTANCEID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;939e41&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;-62&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2-5605&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;-5e05&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;-fc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3554&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;afc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_DEFAULTWORKINGDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/s&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_JOBSTATUS=Succeeded&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ANT_HOME=/usr/share/ant&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_CLEAN=False&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TEAMPROJECT=project&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;PATH=/usr/share/rust/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SELENIUM_JAR_PATH=/usr/share/java/selenium-server-standalone.jar&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;CHROME_BIN=/usr/bin/google-chrome&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_COLLECTIONID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cc&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55890-46&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6-40&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1-9714-8220&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ddd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;bd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_CONTAINERID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5246219&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_TEAMFOUNDATIONCOLLECTIONURI=https://dev.azure.com/brianpfeil/&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;GIT_TERMINAL_PROMPT=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;AGENT_BUILDDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_STAGEID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;96&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ac&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2280-8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;cb&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4-5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;df&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5-99&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;de-dd&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;da&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;759617&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;d&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SYSTEM_ENABLEACCESSTOKEN=SecretVariable&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_BINARIESDIRECTORY=/home/vsts/work/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/b&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;BUILD_BUILDID=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;53&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_URI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/tree/$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEBRANCHNAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;BUILD_REPOSITORY_URI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/commit/$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;BUILD_SOURCEVERSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;athena&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;create&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;CloudFront&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;logs&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;EXTERNAL&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;EXISTS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;default.cloudfront_logs_stagingallthecloudbits&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;`date`&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;DATE,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;location&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;BIGINT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;request_ip&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;method&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;host&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;uri&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;INT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;referrer&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;user_agent&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;query_string&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;cookie&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;result_type&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;request_id&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;host_header&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;request_protocol&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;request_bytes&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;BIGINT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;time_taken&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;FLOAT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;xforwarded_for&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;ssl_protocol&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;ssl_cipher&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;response_result_type&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;http_version&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;fle_status&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;fle_encrypted_fields&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;INT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;c_port&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;INT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;time_to_first_byte&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;FLOAT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;x_edge_detailed_result_type&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;sc_content_type&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;STRING,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;sc_content_len&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;BIGINT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;sc_range_start&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;BIGINT,&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;sc_range_end&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;BIGINT&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;ROW&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;FORMAT&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;DELIMITED&lt;/span&gt; 
&lt;span class=&#34;err&#34;&gt;FIELDS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;TERMINATED&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;\t&amp;#39;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;LOCATION&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;s&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;://dev-agency-website-cloudfrontlogsbucket-jf&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ykpajh&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/cloudfront/logs/staging.allthecloudbits.com/&amp;#39;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;TBLPROPERTIES&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;skip.header.line.count&amp;#39;=&amp;#39;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;query&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cloudfront_logs_stagingallthecloudbits&amp;#34;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;limit&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;CF&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;dist&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;WAF&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;association&lt;/span&gt; 
&lt;span class=&#34;err&#34;&gt;myDistribution&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;AWS::CloudFront::Distribution&lt;/span&gt;
  &lt;span class=&#34;err&#34;&gt;Properties:&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;DistributionConfig:&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;WebACLId:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;!Ref&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;MyWebACL&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;aws&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;managed&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;rule&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;groups&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-list.html&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;AWS::WAFv&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;::WebACL&lt;/span&gt;



   &lt;span class=&#34;err&#34;&gt;Type:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;AWS::WAFv&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;::WebACL&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;Properties:&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;Name:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;waf-webacl&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;Scope:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;CLOUDFRONT&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;Description:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;CloudFront&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;WAF&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;WebACL&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;DefaultAction:&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;Allow:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;VisibilityConfig:&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;SampledRequestsEnabled:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;CloudWatchMetricsEnabled:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;MetricName:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;ExampleWebACLMetric&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;Rules:&lt;/span&gt;
        &lt;span class=&#34;err&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Name:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;RuleWithAWSManagedRules&lt;/span&gt;
          &lt;span class=&#34;err&#34;&gt;Priority:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
          &lt;span class=&#34;err&#34;&gt;OverrideAction:&lt;/span&gt;
            &lt;span class=&#34;err&#34;&gt;Count:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
          &lt;span class=&#34;err&#34;&gt;VisibilityConfig:&lt;/span&gt;
            &lt;span class=&#34;err&#34;&gt;SampledRequestsEnabled:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
            &lt;span class=&#34;err&#34;&gt;CloudWatchMetricsEnabled:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
            &lt;span class=&#34;err&#34;&gt;MetricName:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;RuleWithAWSManagedRulesMetric&lt;/span&gt;
          &lt;span class=&#34;err&#34;&gt;Statement:&lt;/span&gt;
            &lt;span class=&#34;err&#34;&gt;ManagedRuleGroupStatement:&lt;/span&gt;
              &lt;span class=&#34;err&#34;&gt;VendorName:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;AWS&lt;/span&gt;
              &lt;span class=&#34;err&#34;&gt;Name:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;AWSManagedRulesCommonRuleSet&lt;/span&gt;
              &lt;span class=&#34;err&#34;&gt;ExcludedRules:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
</item>
    
    <item>
<title>Azure Kubernetes Service AKS</title>
<link>https://brianpfeil.com/post/azure-kubernetes-service-aks/</link>
<pubDate>Sat, 18 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-kubernetes-service-aks/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-kubernetes-service-aks-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-kubernetes-service-aks-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn azure kubernetes service&lt;/p&gt;
&lt;h2 id=&#34;running&#34;&gt;Running&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# create resource group&lt;/span&gt;
az group create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;pfeilbr-aks-01&amp;#34;&lt;/span&gt; --location eastus

&lt;span class=&#34;c1&#34;&gt;# create cluster&lt;/span&gt;
az aks create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;pfeilbr-aks-01&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;pfeilbr-aks-01&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --node-count &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --location eastus &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --enable-addons monitoring &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --generate-ssh-keys

&lt;span class=&#34;c1&#34;&gt;# set connectivity to cluster for kubectl&lt;/span&gt;
az aks get-credentials --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;pfeilbr-aks-01&amp;#34;&lt;/span&gt; --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;pfeilbr-aks-01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list cluster nodes&lt;/span&gt;
kubectl get nodes

&lt;span class=&#34;c1&#34;&gt;# deploy&lt;/span&gt;
kubectl apply -f azure-vote.yaml

&lt;span class=&#34;c1&#34;&gt;# monitor deployment progress&lt;/span&gt;
kubectl get service azure-vote-front --watch

&lt;span class=&#34;c1&#34;&gt;# open &amp;#34;EXTERNAL-IP&amp;#34; in browser to view webapp&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# delete cluster&lt;/span&gt;
az group delete --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;pfeilbr-aks-01&amp;#34;&lt;/span&gt; --yes --no-wait
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAHFfcVhlCJNT5rYgPkVTwZ4NL5x57QaNd0B/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
</description>
</item>
    
    <item>
<title>Azure Nodejs ARM Resources</title>
<link>https://brianpfeil.com/post/azure-nodejs-arm-resources/</link>
<pubDate>Wed, 15 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-nodejs-arm-resources/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-nodejs-arm-resources-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-nodejs-arm-resources-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;manipulate azure resources (deployments, etc.) programmatically via nodejs&lt;/p&gt;
</description>
</item>
    
    <item>
<title>Azure CLI</title>
<link>https://brianpfeil.com/post/azure-cli/</link>
<pubDate>Tue, 14 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-cli/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-cli-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-cli-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;azure cli usage examples&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# version info&lt;/span&gt;
az -v

&lt;span class=&#34;c1&#34;&gt;# help&lt;/span&gt;
az -h

&lt;span class=&#34;c1&#34;&gt;# find examples&lt;/span&gt;
az find &lt;span class=&#34;s2&#34;&gt;&amp;#34;az functionapp list&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# interactive login&lt;/span&gt;
az login

&lt;span class=&#34;c1&#34;&gt;# log in with a service principal using client secret.&lt;/span&gt;
az login --service-principal -u http://azure-cli-2019-05-09-16-09-40 -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;[CLIENT_SECRET_HERE]&amp;#39;&lt;/span&gt; --tenant brianpfeilgmail.onmicrosoft.com

az &lt;span class=&#34;nb&#34;&gt;logout&lt;/span&gt;

az account show
az account show &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.tenantId&amp;#39;&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;TENANT_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;az account show --query tenantId --output tsv&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;

az account list
az account get-access-token

az account list-locations

&lt;span class=&#34;c1&#34;&gt;# list account fields in table format&lt;/span&gt;
az account list --output table --query &lt;span class=&#34;s1&#34;&gt;&amp;#39;[].{Name:name, SubscriptionId:id, TenantId:tenantId}&amp;#39;&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# details of signed in user&lt;/span&gt;
az ad signed-in-user show

&lt;span class=&#34;c1&#34;&gt;# ad&lt;/span&gt;
az ad -h

&lt;span class=&#34;c1&#34;&gt;# ad service principals&lt;/span&gt;
az ad sp -h

&lt;span class=&#34;c1&#34;&gt;# create a service principal and configure its access to Azure&lt;/span&gt;
az ad sp create-for-rbac

&lt;span class=&#34;c1&#34;&gt;# list service principals&lt;/span&gt;
az ad sp list

&lt;span class=&#34;c1&#34;&gt;# list service principals with subset of properties&lt;/span&gt;
az ad sp list --query &lt;span class=&#34;s2&#34;&gt;&amp;#34;[].{id:appId, tenant:appOwnerTenantId, name:displayName}&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list role assignments for service principal&lt;/span&gt;
az role assignment list --assignee &lt;span class=&#34;s1&#34;&gt;&amp;#39;http://azure-cli-2019-05-09-16-09-40&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list role assignments for user (user sign-in name)&lt;/span&gt;
az role assignment list --assignee &lt;span class=&#34;s1&#34;&gt;&amp;#39;dev01@brianpfeilgmail.onmicrosoft.com&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list role assignments for user (object id)&lt;/span&gt;
az role assignment list --assignee &lt;span class=&#34;s1&#34;&gt;&amp;#39;38d35c72-5a26-464c-bbb3-c4487a1d4779&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list role assignments for service principal&lt;/span&gt;
az role assignment list --assignee &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://service-principal-01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# reset service principal password.  if you forgot or lost it, this is the only way to get it.&lt;/span&gt;
az ad sp credential reset --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://service-principal-01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# {&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;appId&amp;#34;: &amp;#34;00133c8e-a08e-490e-ae7c-872ea2debf1e&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;name&amp;#34;: &amp;#34;http://service-principal-01&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;password&amp;#34;: &amp;#34;09tGSBcRsl_Gml7DI7VkRniFu_r_xxxxxx&amp;#34;,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#   &amp;#34;tenant&amp;#34;: &amp;#34;b0579be4-503f-48ca-9bd2-ca22100857dd&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# }&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# login with service principal&lt;/span&gt;
az login --service-principal --username &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://service-principal-01&amp;#34;&lt;/span&gt; --password &lt;span class=&#34;s2&#34;&gt;&amp;#34;09tGSBcRsl_Gml7DI7VkRniFu_r_xxxxxx&amp;#34;&lt;/span&gt; --tenant &lt;span class=&#34;s2&#34;&gt;&amp;#34;b0579be4-503f-48ca-9bd2-ca22100857dd&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# get access token (bearer)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# NOTE: must be logged in with `service-principal-01` above for this example&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# or may need to add client id to authorize application.  see following screenshot&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# &amp;lt;https://www.evernote.com/l/AAFJLMG88QhDgqehvtS8P-qkVuCcmFFUhCMB/image.png&amp;gt;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;ACCESS_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;az account get-access-token --resource &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://brianpfeilmyfn01.azurewebsites.net&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# call endpoint protected by azure ad.  e.g. functions function endpoint&lt;/span&gt;
curl --header &lt;span class=&#34;s2&#34;&gt;&amp;#34;Authorization: Bearer &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ACCESS_TOKEN&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; https://brianpfeilmyfn01.azurewebsites.net/api/HttpExample

&lt;span class=&#34;c1&#34;&gt;# show service principal details&lt;/span&gt;
az ad sp show --id &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://service-principal-01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# get access token (Bearer) that can be used as `Authorization` header&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# current user&lt;/span&gt;
az account get-access-token

&lt;span class=&#34;c1&#34;&gt;# for specific resource&lt;/span&gt;
az account get-access-token --resource &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://vault.azure.net&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list app registrations&lt;/span&gt;
az ad app list --query &lt;span class=&#34;s1&#34;&gt;&amp;#39;[].{displayName: displayName}&amp;#39;&lt;/span&gt; --output table

&lt;span class=&#34;c1&#34;&gt;# create resource group&lt;/span&gt;
az group create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;group01&amp;#34;&lt;/span&gt; --location eastus

&lt;span class=&#34;c1&#34;&gt;# list resource group names&lt;/span&gt;
az group list &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.[].name&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# delete resource group&lt;/span&gt;
az group delete --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;group01&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# deploy arm template examples&lt;/span&gt;
az group deployment create --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-deployment-01&amp;#34;&lt;/span&gt; --resource-group &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-resource-group-01&amp;#34;&lt;/span&gt;   --template-file template.json --parameters @parameters.json

az group deployment create   --name cosmosdbaccountdeployment01   --resource-group group01   --template-file azure-cosmos-db-account.json   --parameters &lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;account01&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;locationName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;East US&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;defaultExperience&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DocumentDB&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# interactive/repl mode.  immediately exits / doesn&amp;#39;t work as of 2019-05-14&lt;/span&gt;
az interactive


&lt;span class=&#34;c1&#34;&gt;# list all resources&lt;/span&gt;
az resource list

az role assignment list

az role definition list

az role definition list --custom-role-only &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; --output json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.[] | {&amp;#34;roleName&amp;#34;:.roleName, &amp;#34;roleType&amp;#34;:.roleType}&amp;#39;&lt;/span&gt;
az role definition list &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.[].description&amp;#39;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# list storage account&lt;/span&gt;
az storage account list &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.[].name&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
</item>
    
    <item>
<title>Azure JS Cognitive Services</title>
<link>https://brianpfeil.com/post/azure-js-cognitive-services/</link>
<pubDate>Mon, 13 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-js-cognitive-services/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-js-cognitive-services-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-js-cognitive-services-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/cognitive-services/&#34;&gt;azure cognitive services&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Examples&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;runHandwrittenOCRForURL()&lt;/code&gt; - uses computer vision &lt;code&gt;batchReadFile&lt;/code&gt; API to perform handwritten OCR on a image of a form (image sourced from public URL).&lt;/p&gt;
&lt;h2 id=&#34;resources&#34;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/azure/cognitive-services/computer-vision/&#34;&gt;cognitive-services/computer-vision docs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;running&#34;&gt;Running&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Create new cognitive services computer vision resource&lt;br&gt;
run &lt;code&gt;az login&lt;/code&gt;, then &lt;code&gt;npm run provision&lt;/code&gt;&lt;br&gt;
OR via portal
&lt;img src=&#34;https://www.evernote.com/l/AAHErRlR-tFBJbb6x-JKpZTcsQpxXyx4KAAB/image.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;Copy &lt;a href=&#34;.env.sample&#34;&gt;&lt;code&gt;.env.sample&lt;/code&gt;&lt;/a&gt; to &lt;code&gt;.env&lt;/code&gt; and populate with values via the following steps.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CLIENT_ID&lt;/code&gt;, &lt;code&gt;DOMAIN&lt;/code&gt;
&lt;img src=&#34;https://www.evernote.com/l/AAExoADr6tVHoLj4lOD_58FCSWmWAelxCrMB/image.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;SUBSCRIPTION_ID
&lt;img src=&#34;https://www.evernote.com/l/AAGdlioOXwpHEoGofH2nL-PJAIIOWlkvoiQB/image.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;COGNITIVE_SERVICES_ENDPOINT&lt;/code&gt;
&lt;img src=&#34;https://www.evernote.com/l/AAETKioZuRpHD48_sa7nDTP5A-5zla0Oew0B/image.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;COGNITIVE_SERVICES_KEY&lt;/code&gt;
&lt;img src=&#34;https://www.evernote.com/l/AAHdTNN4abtGmq5ZKgwh2vD6uOURbM6mhHwB/image.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;run &lt;code&gt;npm start&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
</item>
    
    <item>
<title>Azure Nodejs ARM Storage</title>
<link>https://brianpfeil.com/post/azure-nodejs-arm-storage/</link>
<pubDate>Fri, 10 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-nodejs-arm-storage/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-nodejs-arm-storage-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-nodejs-arm-storage-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;manipulate azure storage accounts programmatically via nodejs&lt;/p&gt;
&lt;h2 id=&#34;resources&#34;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/javascript/api/overview/azure/storage?view=azure-node-latest&#34;&gt;Azure Storage modules for Node.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
</item>
    
    <item>
<title>Azure SDK for Node Authentication</title>
<link>https://brianpfeil.com/post/azure-sdk-for-node-authentication/</link>
<pubDate>Fri, 10 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-sdk-for-node-authentication/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-sdk-for-node-authentication-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-sdk-for-node-authentication-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn authentication methods for azure sdk for nodejs&lt;/p&gt;
&lt;h2 id=&#34;service-principal-authentication&#34;&gt;Service Principal Authentication&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Based on &lt;a href=&#34;https://github.com/Azure/azure-sdk-for-node/blob/master/Documentation/Authentication.md#service-principal-authentication&#34;&gt;azure-sdk-for-node/Documentation/Authentication.md&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clientId&lt;/code&gt;, &lt;code&gt;secret&lt;/code&gt;, and &lt;code&gt;domain&lt;/code&gt; are defined in &lt;code&gt;.env&lt;/code&gt;.  Copy &lt;a href=&#34;.env.sample&#34;&gt;&lt;code&gt;.env.sample&lt;/code&gt;&lt;/a&gt; to &lt;code&gt;.env&lt;/code&gt; and populate with values via the following steps.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;getting &lt;code&gt;clientId&lt;/code&gt; and &lt;code&gt;domain&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;run &lt;code&gt;az ad sp list&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.evernote.com/l/AAHU6ONDbO1KYIVV93m8-xaJWKd4r3SolgoB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;getting / creating secret&lt;/p&gt;
&lt;p&gt;navigate to &lt;strong&gt;Portal | Azure Active Directory | App registrations&lt;/strong&gt;
create new client secret if needed OR use existing
&lt;img src=&#34;https://www.evernote.com/l/AAHlB4MduMBFjadlw1JlXT6hfMVn5OBBSIwB/image.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
</item>
    
    <item>
<title>Azure Serverless Framework</title>
<link>https://brianpfeil.com/post/azure-serverless-framework/</link>
<pubDate>Fri, 10 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-serverless-framework/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-serverless-framework-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-serverless-framework-playground&lt;/a&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;learn &lt;a href=&#34;https://serverless.com/framework/docs/providers/azure/&#34;&gt;serverless framework for azure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;source @  &lt;a href=&#34;src/services/hello-world&#34;&gt;&lt;code&gt;src/services/hello-world&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;see &lt;a href=&#34;https://serverless.com/framework/docs/providers/azure/guide/credentials/&#34;&gt;Azure - Credentials&lt;/a&gt; for getting setup&lt;/li&gt;
&lt;/ul&gt;
</description>
</item>
    
    <item>
<title>Azure Cosmos JS SDK</title>
<link>https://brianpfeil.com/post/azure-cosmos-js-sdk/</link>
<pubDate>Wed, 08 May 2019 00:00:00 -0400</pubDate>
      
      <guid>https://brianpfeil.com/post/azure-cosmos-js-sdk/</guid>
<description>&lt;div class=&#34;alert alert-info small bg-info&#34; role=&#34;alert&#34;&gt;
&lt;span class=&#34;text-muted&#34;&gt;code for article&lt;/span&gt;&amp;nbsp;&lt;a href=&#34;https://github.com/pfeilbr/azure-cosmos-js-sdk-playground&#34; target=&#34;_blank&#34;&gt;&lt;i class=&#34;fab fa-github fa-sm&#34;&gt;&lt;/i&gt;&amp;nbsp;pfeilbr/azure-cosmos-js-sdk-playground&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;learn &lt;a href=&#34;https://github.com/azure/azure-cosmos-js&#34;&gt;azure cosmos db javascript sdk&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;running&#34;&gt;Running&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;provision resources
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# create group&lt;/span&gt;
az group create --name group01 --location &lt;span class=&#34;s2&#34;&gt;&amp;#34;East US&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create cosmos db account&lt;/span&gt;
az group deployment create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--name cosmosdbaccountdeployment01 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--resource-group group01 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--template-file arm-templates/azure-cosmos-db-account.json &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--parameters &lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;account01&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;eastus&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;locationName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;East US&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;defaultExperience&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DocumentDB&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;copy &lt;code&gt;.env.sample&lt;/code&gt; to &lt;code&gt;.env&lt;/code&gt; and populate with your information from &lt;strong&gt;Keys&lt;/strong&gt;
&lt;img src=&#34;https://www.evernote.com/l/AAG3s-Zs6VRIPa7fvjL6KuMP03bCj8nDKhYB/image.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;run &lt;code&gt;npm start&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
</item>
    
  </channel>
</rss>