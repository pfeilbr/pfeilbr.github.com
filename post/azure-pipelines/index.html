<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Azure Pipelines - Brian Pfeil</title>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Brian Pfeil","url":"https:\/\/brianpfeil.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/brianpfeil.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/brianpfeil.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/brianpfeil.com\/post\/azure-pipelines\/","name":"Azure pipelines"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Brian Pfeil"},"headline":"Azure Pipelines","description":"","inLanguage":"en","wordCount":1493,"datePublished":"2020-02-26T00:00:00\u002b00:00","dateModified":"2020-02-26T00:00:00\u002b00:00","image":"https:\/\/brianpfeil.com\/","keywords":["azure"],"mainEntityOfPage":"https:\/\/brianpfeil.com\/post\/azure-pipelines\/","publisher":{"@type":"Organization","name":"https:\/\/brianpfeil.com\/","logo":{"@type":"ImageObject","url":"https:\/\/brianpfeil.com\/","height":60,"width":60}}}</script><meta property="og:title" content="Azure Pipelines"><meta property="og:url" content="https://brianpfeil.com/post/azure-pipelines/"><meta property="og:type" content="website"><meta property="og:site_name" content="Brian Pfeil"><meta name=twitter:title content="Azure Pipelines"><meta name=twitter:card content="summary_large_image"><meta name=generator content="Hugo 0.124.1"><link rel=alternate href=https://brianpfeil.com/index.xml type=application/rss+xml title="Brian Pfeil"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://brianpfeil.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://brianpfeil.com/css/highlight.min.css><link rel=stylesheet href=https://brianpfeil.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=https://brianpfeil.com/css/custom.css><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-610553-4","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://brianpfeil.com/>Brian Pfeil</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=about href=/about/>about</a></li><li><a title=posts href=/>posts</a></li><li><a title=projects href=/projects/>projects</a></li><li><a title=tags href=/tags/>tags</a></li><li><a id=dark-mode-toggle><i class="fa fa-moon hidden" id=dark-mode-enabled-icon aria-hidden=true></i>
<i class="fa fa-sun hidden" id=dark-mode-disabled-icon aria-hidden=true></i></a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Azure Pipelines</h1><span class=post-meta>February 26, 2020
<span class=blog-tags>&nbsp;&bull;&nbsp;
<a href=https://brianpfeil.com//tags/azure/>azure</a></span></span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><div class="alert alert-info small bg-info" role=alert><span class=text-muted>code for article</span>&nbsp;<a href=https://github.com/pfeilbr/azure-pipelines-playground target=_blank><i class="fab fa-github fa-sm"></i>&nbsp;pfeilbr/azure-pipelines-playground</a></div><p>learn <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops">azure pipelines</a></p><ul><li><a href=#azure-pipelines-playground>azure-pipelines-playground</a><ul><li><a href=#description>Description</a></li><li><a href=#infrastructure-provisioning-steps>Infrastructure Provisioning Steps</a></li><li><a href=#website-content-publishing-steps>Website Content Publishing Steps</a></li><li><a href=#deprovisioning>Deprovisioning</a></li><li><a href=#architecture>Architecture</a></li><li><a href=#key-files-and-directories>Key Files and Directories</a></li><li><a href=#screenshots>Screenshots</a></li><li><a href=#todo>TODO</a></li><li><a href=#completed--cancelled>Completed / Cancelled</a></li><li><a href=#notes>Notes</a></li><li><a href=#scratch>Scratch</a></li></ul></li></ul><hr><h2 id=description>Description</h2><p>Pipeline performs an atomic deploy of static content from a github repo to a static site (Rout53 + ACM + WAF CloudFront + S3 when) a tag (release)
is applied to the repo</p><h2 id=infrastructure-provisioning-steps>Infrastructure Provisioning Steps</h2><ol><li>create route 53 hosted zone for your domain name (e.g. <code>mydomain.com</code>)</li><li>update <code>DOMAIN_NAME</code> parameter in <a href=scripts/stack.sh><code>scripts/stack.sh</code></a> with the hosted zone name</li><li>provision aws resources <code>./scripts/stack.sh create</code></li><li>Check ACM to confirm Certificate validation via DNS validation has completed. May need to add DNS validation records to route53 hosted zone.</li><li>update pipeline variables<ul><li>REGION - <em>default is us-east-1</em></li><li>STACK_NAME - defined in <a href=scripts/stack.sh><code>scripts/stack.sh</code></a></li><li>AWS_ACCESS_KEY_ID - <code>AccessKey</code> output in <code>./tmp/${STACK_NAME}-outputs.json</code></li><li>AWS_SECRET_ACCESS_KEY - <code>SecretKey</code> output in <code>./tmp/${STACK_NAME}-outputs.json</code></li></ul></li></ol><h2 id=website-content-publishing-steps>Website Content Publishing Steps</h2><ol><li>ensure you have <code>develop</code> branch checked out <em>(this corresponds to staging environment)</em></li><li>update website content in <a href=public><code>public</code></a> directory and push to github.</li><li><em>(optional)</em> update redirect rules in <a href=routing-rules/routing-rules.txt><code>routing-rules/routing-rules.txt</code></a></li><li>push your commit(s) to remote (github)</li><li>publish will run. can take up to 20 minutes to complete due CloudFront distribution update.</li><li>verify updated content by visiting <a href=https://staging.mydomain.com>https://staging.mydomain.com</a></li><li>to publish staging to production, checkout master branch and merge in develop</li><li>push your commit(s) to remote (github)</li><li>verify updated content by visiting <a href=https://mydomain.com>https://mydomain.com</a> and <a href=https://www.mydomain.com>https://www.mydomain.com</a></li></ol><h2 id=deprovisioning>Deprovisioning</h2><ol><li>deprovision aws resources <code>./scripts/stack.sh delete</code></li><li><em>(optional)</em> manually delete S3 website and CloudFront logs buckets.<blockquote><p>these are not deleted because they still contain objects</p></blockquote></li><li><em>(optional)</em> run <code>./scripts/stack.sh delete</code> again to permanently delete stack</li></ol><hr><h2 id=architecture>Architecture</h2><p><img src=assets/images/architecture.png alt=architecture></p><hr><h2 id=key-files-and-directories>Key Files and Directories</h2><ul><li><a href=cfn-templates/resources.yaml><code>cfn-templates/resources.yaml</code></a> - CloudFormation stack for provisioning AWS resources.<ul><li>S3 bucket(s) for static content (staging + production)</li><li>CloudFront distribution(s) (staging + production)</li><li>lambda@edge function for basic auth for staging site</li><li>WAF Web ACL for CloudFront distribution(s)</li><li>aws secrets manager secret (json doc) to store basic auth users</li><li>S3 bucket for CloudFront access logs</li><li>SSL Certificate (ACM)</li><li>route53 root domain ALIAS record to CloudFront distribution</li><li>route53 <strong>staging</strong> and <strong>www</strong> CNAME records to CloudFront distribution</li><li>IAM user for CI/CD automation used by the azure pipeline</li></ul></li><li><a href=public><code>public</code></a> - static web content</li><li><a href=scripts/stack.sh><code>scripts/stack.sh</code></a> - provisions AWS resources</li><li><a href=tmp/automation-stack-outputs.json><code>tmp/automation-outputs.json</code></a> - stack outputs stored here. <em>file gets created when stack is provisioned.</em></li><li><a href=scripts/tag-and-trigger-publish.sh><code>scripts/tag-and-trigger-publish.sh</code></a> - tags and pushes the tag to github to trigger the publish pipeline</li><li><a href=scripts/publish.sh><code>scripts/publish.sh</code></a> - publishes a new version of the static site based on git tag. this is used by pipeline</li><li><a href=azure-pipelines.yml><code>azure-pipelines.yml</code></a> - pipeline definition that get triggered on tag to publish to site</li></ul><hr><h2 id=screenshots>Screenshots</h2><p><strong>Pipeline Variables</strong></p><p><img src=https://www.evernote.com/l/AAHE5oOGeN9Kv7oZa-EDbz0NwbJwlITnmBkB/image.png alt></p><hr><h2 id=todo>TODO</h2><ul><li>route53 CNAME record to point directly to S3 bucket website domain. used to troubleshoot/bypass cache issues.<ul><li>e.g. <a href=https://bucket.mysite.com>https://bucket.mysite.com</a> -> <a href=https://bucket.s3-website-us-east-1.amazonaws.com>https://bucket.s3-website-us-east-1.amazonaws.com</a></li><li>research basic auth options<ul><li>ok not to have basic auth?</li></ul></li></ul></li></ul><h2 id=completed--cancelled>Completed / Cancelled</h2><ul><li>add WAF ACL and associate to CF dist(s)<ul><li>see <a href="https://forums.aws.amazon.com/thread.jspa?messageID=936616&amp;#936616">Web ACL created om WAF V2 not accessible on CloudFront</a></li></ul></li><li>add API origin to CF distribution for requests to /api/* path<ul><li>precedence to 1, forward query strings, cookies, all all HTTP methods</li><li>this is IMPORTANT <strong>You can indeed put CF dist in front of APIG, the trick is to force HTTPS only &ldquo;Viewer Protocol Policy&rdquo; AND to NOT forward the HOST header because APIG needs SNI</strong>. see <a href=https://stackoverflow.com/questions/32825413/how-do-you-add-cloudfront-in-front-of-api-gateway>How do you add CloudFront in front of API Gateway</a></li><li><a href=https://advancedweb.hu/how-to-use-api-gateway-with-cloudfront/>How to use API Gateway with CloudFront</a></li></ul></li><li>add staging CloudFront distribution<ul><li>options<ul><li>separate bucket s3://stage s3://prod</li><li>single bucket with prefix s3://bucket/stage/* s3://bucket/prod/*</li></ul></li></ul></li><li>update s3 redirect/routing rules for deploy version prefix<ul><li>e.g. domain.com/oldlink would point to /v0.0.1/newlink in the bucket. the <code>/v0.0.1</code> prefix need to be updated in all redirect rules on deploy</li><li>see <a href=https://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-website.html>https://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-website.html</a></li></ul></li><li>more reliable method of picking the origin path to update since there are two origins</li><li>create IAM policy and role for resource provisioning<ul><li>look at CloudFormation | Stack | Resources view for resource types</li><li>specify resource name prefix and suffix as variable to allow for change</li><li>specify role-arn for cloudformation cli</li></ul></li><li>redirects<ul><li>options<ul><li>via lambda@edge</li><li>check if WAF supports</li><li>S3 bucket routing rules (<code>AWS::S3::Bucket RoutingRule</code>)</li><li>s3 object metadata header. see <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/how-to-page-redirect.html#advanced-conditional-redirects>(Optional) Configuring a Webpage Redirect</a> and <a href=https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html#RESTObjectCOPY-requests-request-headers><code>x-amz-website-redirect-location</code></a><blockquote><p>If the bucket is configured as a website, redirects requests for this object to another object in the same bucket or to an external URL. Amazon S3 stores the value of this header in the object metadata.</p></blockquote><ul><li>trailing slashes: see the following on how to handle <a href="https://forums.aws.amazon.com/thread.jspa?threadID=168000#jive-message-592535">Re: S3 make a non-trailing slash URL send a 301 instead of a 302</a></li></ul></li></ul></li></ul></li><li>basic auth on staging cloudfront dist<ul><li>options<ul><li>lambda@edge</li><li>WAF rule for Authorization header</li></ul></li></ul></li><li>update <code>scripts/publish.sh</code> with proper cache control for index.html (no-cache)<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>aws s3 sync --cache-control <span class=s1>&#39;max-age=604800&#39;</span> --exclude index.html build/ s3://mywebsitebucket/
</span></span><span class=line><span class=cl>aws s3 sync --cache-control <span class=s1>&#39;no-cache&#39;</span> build/ s3://mywebsitebucket/
</span></span></code></pre></div></li><li>deny requests directly to s3. must use domain. remove OAI and add this. this will allows redirects in S3 to work.<ul><li>see <a href=https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-serve-static-website/>How do I use CloudFront to serve a static website hosted on Amazon S3?</a> for details.</li><li>TLDR; the referer is set on the CloudFront distribution and is a secret. the S3 bucket policy only allows requests from this referer</li><li><a href=https://aws.amazon.com/premiumsupport/knowledge-center/s3-rest-api-cloudfront-error-403/>I’m using an S3 REST API endpoint as the origin of my CloudFront distribution. Why am I getting 403 Access Denied errors?</a></li><li><a href=https://aws.amazon.com/premiumsupport/knowledge-center/s3-website-cloudfront-error-403/>I’m using an S3 website endpoint as the origin of my CloudFront distribution. Why am I getting 403 Access Denied errors?</a><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Id&#34;</span><span class=p>:</span> <span class=s2>&#34;http referer policy ${DomainName}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow get requests referred by ${DomainName}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Principal&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;s3:GetObject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:s3:::${BUCKET}/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Condition&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;StringLike&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;aws:Referer&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;http://${DomainName}/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;https://${DomainName}/*&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;Explicit deny to ensure requests are allowed only from specific referer.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Deny&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Principal&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;s3:GetObject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:s3:::${BUCKET}/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Condition&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;StringNotLike&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;aws:Referer&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;http://${DomainName}/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;https://${DomainName}/*&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ul></li></ul><hr><h2 id=notes>Notes</h2><ul><li>pipeline is running in azure DevOps tied to personal gmail account</li></ul><hr><h2 id=scratch>Scratch</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># delete all remote tags</span>
</span></span><span class=line><span class=cl>git tag -l <span class=p>|</span> xargs -n <span class=m>1</span> git push --delete origin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># delete all local tags</span>
</span></span><span class=line><span class=cl>git tag <span class=p>|</span> xargs git tag -d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#REDIRECT_LOCATION=&#34;https://allthecloudbits.com/products/product02/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>REGION</span><span class=o>=</span><span class=s2>&#34;us-east-1&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>STACK_NAME</span><span class=o>=</span><span class=s2>&#34;dev-agency-website&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BUCKET</span><span class=o>=</span><span class=k>$(</span>aws cloudformation describe-stacks --region <span class=s2>&#34;</span><span class=si>${</span><span class=nv>REGION</span><span class=si>}</span><span class=s2>&#34;</span> --stack-name <span class=s2>&#34;</span><span class=si>${</span><span class=nv>STACK_NAME</span><span class=si>}</span><span class=s2>&#34;</span> --query <span class=s2>&#34;Stacks[0].Outputs[?OutputKey==&#39;WebsiteBucketName&#39;].OutputValue&#34;</span> --output text<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>PREFIX</span><span class=o>=</span><span class=s2>&#34;v0.0.1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TARGET</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>PREFIX</span><span class=si>}</span><span class=s2>/about&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>REDIRECT_LOCATION</span><span class=o>=</span><span class=s2>&#34;/about/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws --profile automation-user s3api put-object <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --bucket <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --key <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --website-redirect-location <span class=s2>&#34;</span><span class=si>${</span><span class=nv>REDIRECT_LOCATION</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --content-length <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws --profile automation-user s3api head-object <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --bucket <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --key <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws --profile automation-user s3api delete-object <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --bucket <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --key <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws --profile automation-user s3api list-objects <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --bucket <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>policy components</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Principal&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:iam::529276214230:user/admin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;s3:*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:s3:::dev-agency-website-s3bucketforwebsitecontent-11u56g1n9u9oo/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Principal&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;s3:GetObject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:s3:::dev-agency-website-s3bucketforwebsitecontent-11u56g1n9u9oo/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Condition&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;StringLike&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;aws:Referer&#34;</span><span class=p>:</span> <span class=s2>&#34;79011a81-c048-4877-84f4-efe9577d7250&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Deny&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Principal&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;s3:GetObject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:s3:::dev-agency-website-s3bucketforwebsitecontent-11u56g1n9u9oo/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Condition&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;StringNotLike&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;aws:Referer&#34;</span><span class=p>:</span> <span class=s2>&#34;79011a81-c048-4877-84f4-efe9577d7250&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>create_routing_rule()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>bucket=$1</span>
</span></span><span class=line><span class=cl>    <span class=err>prefix=$2</span>
</span></span><span class=line><span class=cl>    <span class=err>target=$3</span>
</span></span><span class=line><span class=cl>    <span class=err>redirect_location=$4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>aws</span> <span class=err>s3api</span> <span class=err>put-object</span> <span class=err>\</span>
</span></span><span class=line><span class=cl>        <span class=err>--bucket</span> <span class=nt>&#34;${bucket}&#34;</span> <span class=err>\</span>
</span></span><span class=line><span class=cl>        <span class=err>--key</span> <span class=s2>&#34;${prefix}${target}&#34;</span> <span class=err>\</span>
</span></span><span class=line><span class=cl>        <span class=err>--website-redirect-location</span> <span class=s2>&#34;${redirect_location}&#34;</span> <span class=err>\</span>
</span></span><span class=line><span class=cl>        <span class=err>--content-length</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>create_routing_rules()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>bucket=$1</span>
</span></span><span class=line><span class=cl>    <span class=err>prefix=$2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>IFS=$&#39;\r\n&#39;</span> <span class=err>GLOBIGNORE=&#39;*&#39;</span> <span class=err>rules=($(cat</span> <span class=err>routing-rules/routing-rules.txt))</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>for</span> <span class=err>rule</span> <span class=err>in</span> <span class=nt>&#34;${rules[@]}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>do</span>
</span></span><span class=line><span class=cl>        <span class=err>components=($(echo</span> <span class=err>$rule</span> <span class=err>|</span> <span class=err>tr</span> <span class=s2>&#34; &#34;</span> <span class=s2>&#34;\r\n&#34;</span><span class=err>))</span>
</span></span><span class=line><span class=cl>        <span class=err>target=</span><span class=s2>&#34;${components[1]}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=err>redirect_location=</span><span class=s2>&#34;${components[2]}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=err>#</span> <span class=err>echo</span> <span class=s2>&#34;target=${target}, redirect_location=${redirect_location}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=err>create_routing_rule</span> <span class=s2>&#34;${bucket}&#34;</span> <span class=s2>&#34;${prefix}&#34;</span> <span class=s2>&#34;${target}&#34;</span> <span class=s2>&#34;${redirect_location}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>done</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>create_routing_rules</span> <span class=s2>&#34;dev-agency-website-s3bucketforwebsitecontent-1fbv8htrn7nna&#34;</span> <span class=s2>&#34;v0.0.1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>on</span> <span class=err>tag</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEBRANCHNAME=v</span><span class=mf>0.0</span><span class=err>.</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEBRANCH=refs/tags/v</span><span class=mf>0.0</span><span class=err>.</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSION=f</span><span class=mi>302</span><span class=err>ed</span><span class=mf>7e007</span><span class=err>e</span><span class=mi>57</span><span class=err>c</span><span class=mi>118</span><span class=err>a</span><span class=mi>8835</span><span class=err>f</span><span class=mi>378</span><span class=err>ddd</span><span class=mi>04</span><span class=err>f</span><span class=mf>63e105</span><span class=err>c</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSIONMESSAGE=output</span> <span class=err>env</span> <span class=err>variables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>on</span> <span class=err>develop</span> <span class=err>branch</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEBRANCHNAME=develop</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEBRANCH=refs/heads/develop</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSION=e</span><span class=mi>59</span><span class=err>a</span><span class=mi>3</span><span class=err>dfea</span><span class=mi>5</span><span class=err>bd</span><span class=mi>88</span><span class=err>be</span><span class=mi>3808</span><span class=err>f</span><span class=mi>46</span><span class=err>b</span><span class=mi>48</span><span class=err>da</span><span class=mi>7</span><span class=err>ddd</span><span class=mf>83e8</span><span class=err>b</span><span class=mi>809</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSIONMESSAGE=output</span> <span class=err>env</span> <span class=err>variables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>pipeline</span> <span class=err>environment</span> <span class=err>variables</span>
</span></span><span class=line><span class=cl><span class=err>LEIN_HOME=/usr/local/lib/lein</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_QUEUEDBY=GitHub</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_HOMEDIRECTORY=/home/vsts/agents/</span><span class=mf>2.165</span><span class=err>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>M</span><span class=mi>2</span><span class=err>_HOME=/usr/share/apache-maven</span><span class=mf>-3.6</span><span class=err>.</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=err>BOOST_ROOT=/usr/local/share/boost/</span><span class=mf>1.69</span><span class=err>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_STAGEDISPLAYNAME=__default</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_VERSION=</span><span class=mf>2.165</span><span class=err>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBATTEMPT=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>GOROOT_</span><span class=mi>1</span><span class=err>_</span><span class=mi>11</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/local/go</span><span class=mf>1.11</span>
</span></span><span class=line><span class=cl><span class=err>ANDROID_HOME=/usr/local/lib/android/sdk</span>
</span></span><span class=line><span class=cl><span class=err>JAVA_HOME_</span><span class=mi>11</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/lib/jvm/zulu</span><span class=mi>-11</span><span class=err>-azure-amd</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TEAMFOUNDATIONSERVERURI=https:</span><span class=c1>//dev.azure.com/brianpfeil/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>ImageVersion=</span><span class=mf>20200301.1</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_TOOLSDIRECTORY=/opt/hostedtoolcache</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_DEFINITIONID=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_DISABLELOGPLUGIN_TESTFILEPUBLISHERPLUGIN=</span><span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=err>LANG=C.UTF</span><span class=mi>-8</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_WORKFOLDER=/home/vsts/work</span>
</span></span><span class=line><span class=cl><span class=err>AZURE_EXTENSION_DIR=/opt/az/azcliextensions</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_DEFINITIONNAME=pfeilbr.azure-pipelines-playground</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_TEMPDIRECTORY=/home/vsts/work/_temp</span>
</span></span><span class=line><span class=cl><span class=err>INVOCATION_ID=</span><span class=mi>71</span><span class=err>a</span><span class=mi>915879</span><span class=err>cc</span><span class=mi>04391</span><span class=err>a</span><span class=mf>20e7</span><span class=err>d</span><span class=mi>2867</span><span class=err>d</span><span class=mi>21806</span>
</span></span><span class=line><span class=cl><span class=err>JAVA_HOME_</span><span class=mi>12</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/lib/jvm/zulu</span><span class=mi>-12</span><span class=err>-azure-amd</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=err>AWS_SECRET_ACCESS_KEY=***</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REQUESTEDFOR=Brian</span> <span class=err>Pfeil</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PHASENAME=Job</span>
</span></span><span class=line><span class=cl><span class=err>ANDROID_SDK_ROOT=/usr/local/lib/android/sdk</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBIDENTIFIER=Job.__default</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PULLREQUEST_ISFORK=False</span>
</span></span><span class=line><span class=cl><span class=err>JAVA_HOME=/usr/lib/jvm/zulu</span><span class=mi>-8</span><span class=err>-azure-amd</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBPARALLELISMTAG=Private</span>
</span></span><span class=line><span class=cl><span class=err>DOTNET_SKIP_FIRST_TIME_EXPERIENCE=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>USER=vsts</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REASON=IndividualCI</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_OS=Linux</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_ISSCHEDULED=False</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSION=f</span><span class=mi>302</span><span class=err>ed</span><span class=mf>7e007</span><span class=err>e</span><span class=mi>57</span><span class=err>c</span><span class=mi>118</span><span class=err>a</span><span class=mi>8835</span><span class=err>f</span><span class=mi>378</span><span class=err>ddd</span><span class=mi>04</span><span class=err>f</span><span class=mf>63e105</span><span class=err>c</span>
</span></span><span class=line><span class=cl><span class=err>ENDPOINT_URL_SYSTEMVSSCONNECTION=https:</span><span class=c1>//dev.azure.com/brianpfeil/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>BUILD_SOURCEBRANCH=refs/tags/v</span><span class=mf>0.0</span><span class=err>.</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>GRADLE_HOME=/usr/share/gradle</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_WORKFOLDER=/home/vsts/work</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_QUEUEDBYID=a</span><span class=mf>399e9</span><span class=err>b</span><span class=mi>2</span><span class=err>-ba</span><span class=mi>17-47</span><span class=err>ed</span><span class=mi>-9005-8</span><span class=err>c</span><span class=mi>263530</span><span class=err>afdf</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_DISABLELOGPLUGIN_TESTRESULTLOGPLUGIN=</span><span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_ROOTDIRECTORY=/home/vsts/work</span>
</span></span><span class=line><span class=cl><span class=err>PWD=/home/vsts/work/</span><span class=mi>1</span><span class=err>/s</span>
</span></span><span class=line><span class=cl><span class=err>ImageOS=ubuntu</span><span class=mi>18</span>
</span></span><span class=line><span class=cl><span class=err>HOME=/home/vsts</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_ID=</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=err>GOROOT=/usr/local/go</span><span class=mf>1.12</span>
</span></span><span class=line><span class=cl><span class=err>JOURNAL_STREAM=</span><span class=mi>9</span><span class=err>:</span><span class=mi>31906</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TOTALJOBSINPHASE=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_COLLECTIONURI=https:</span><span class=c1>//dev.azure.com/brianpfeil/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>RUNNER_TOOLSDIRECTORY=/opt/hostedtoolcache</span>
</span></span><span class=line><span class=cl><span class=err>JAVA_HOME_</span><span class=mi>8</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/lib/jvm/zulu</span><span class=mi>-8</span><span class=err>-azure-amd</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_OSARCHITECTURE=X</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_CULTURE=en-US</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TEAMPROJECTID=</span><span class=mi>398</span><span class=err>b</span><span class=mi>5300-9203-4</span><span class=err>d</span><span class=mi>2</span><span class=err>c</span><span class=mi>-957</span><span class=err>c</span><span class=mi>-82</span><span class=err>eedb</span><span class=mi>6</span><span class=err>aea</span><span class=mi>92</span>
</span></span><span class=line><span class=cl><span class=err>VSTS_AGENT_PERFLOG=/home/vsts/perflog</span>
</span></span><span class=line><span class=cl><span class=err>CONDA=/usr/share/miniconda</span>
</span></span><span class=line><span class=cl><span class=err>PIPELINE_WORKSPACE=/home/vsts/work/</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>GOROOT_</span><span class=mi>1</span><span class=err>_</span><span class=mi>13</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/local/go</span><span class=mf>1.13</span>
</span></span><span class=line><span class=cl><span class=err>BOOST_ROOT_</span><span class=mi>1</span><span class=err>_</span><span class=mi>69</span><span class=err>_</span><span class=mi>0</span><span class=err>=/usr/local/share/boost/</span><span class=mf>1.69</span><span class=err>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBPOSITIONINPHASE=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>DEBIAN_FRONTEND=noninteractive</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBID=</span><span class=mi>12</span><span class=err>f</span><span class=mi>1170</span><span class=err>f</span><span class=mi>-54</span><span class=err>f</span><span class=mi>2-53</span><span class=err>f</span><span class=mi>3-20</span><span class=err>dd</span><span class=mi>-22</span><span class=err>fc</span><span class=mi>7</span><span class=err>dff</span><span class=mi>55</span><span class=err>f</span><span class=mi>9</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_JOBNAME=Job</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_ACCEPTTEEEULA=True</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_STAGEATTEMPT=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PIPELINESTARTTIME=</span><span class=mi>2020-03-05</span> <span class=mi>22</span><span class=err>:</span><span class=mi>20</span><span class=err>:</span><span class=mi>12</span><span class=err>+</span><span class=mi>00</span><span class=err>:</span><span class=mi>00</span>
</span></span><span class=line><span class=cl><span class=err>STACK_NAME=dev-agency-website</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REPOSITORY_URI=https:</span><span class=c1>//github.com/pfeilbr/azure-pipelines-playground
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>AGENT_READONLYVARIABLES=</span><span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REPOSITORY_PROVIDER=GitHub</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TASKINSTANCENAME=CmdLine</span>
</span></span><span class=line><span class=cl><span class=err>GOROOT_</span><span class=mi>1</span><span class=err>_</span><span class=mi>12</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/local/go</span><span class=mf>1.12</span>
</span></span><span class=line><span class=cl><span class=err>GECKOWEBDRIVER=/usr/local/share/gecko_driver</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PLANID=b</span><span class=mi>5</span><span class=err>cbb</span><span class=mi>7</span><span class=err>c</span><span class=mi>3-6</span><span class=err>a</span><span class=mi>1</span><span class=err>c</span><span class=mi>-4</span><span class=err>c</span><span class=mi>2</span><span class=err>f</span><span class=mi>-85</span><span class=err>da</span><span class=mi>-7</span><span class=err>cd</span><span class=mi>89</span><span class=err>b</span><span class=mi>56</span><span class=err>bfcc</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_DEFINITIONVERSION=</span><span class=mi>13</span>
</span></span><span class=line><span class=cl><span class=err>TASK_DISPLAYNAME=deploy</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_HOSTTYPE=build</span>
</span></span><span class=line><span class=cl><span class=err>CHROMEWEBDRIVER=/usr/local/share/chrome_driver</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_STAGINGDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/a</span>
</span></span><span class=line><span class=cl><span class=err>MSDEPLOY_HTTP_USER_AGENT=VSTS_</span><span class=mi>1</span><span class=err>cc</span><span class=mi>55890-46</span><span class=err>d</span><span class=mi>6-40</span><span class=err>c</span><span class=mi>1-9714-8220</span><span class=err>ddd</span><span class=mi>17</span><span class=err>bd</span><span class=mi>5</span><span class=err>_build_</span><span class=mi>1</span><span class=err>_</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REQUESTEDFOREMAIL=brian.pfeil@gmail.com</span>
</span></span><span class=line><span class=cl><span class=err>TF_BUILD=True</span>
</span></span><span class=line><span class=cl><span class=err>AZURE_HTTP_USER_AGENT=VSTS_</span><span class=mi>1</span><span class=err>cc</span><span class=mi>55890-46</span><span class=err>d</span><span class=mi>6-40</span><span class=err>c</span><span class=mi>1-9714-8220</span><span class=err>ddd</span><span class=mi>17</span><span class=err>bd</span><span class=mi>5</span><span class=err>_build_</span><span class=mi>1</span><span class=err>_</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REPOSITORY_LOCALPATH=/home/vsts/work/</span><span class=mi>1</span><span class=err>/s</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PHASEDISPLAYNAME=Job</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REPOSITORY_NAME=pfeilbr/azure-pipelines-playground</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_ARTIFACTSTAGINGDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/a</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TASKDEFINITIONSURI=https:</span><span class=c1>//dev.azure.com/brianpfeil/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>BUILD_REPOSITORY_GIT_SUBMODULECHECKOUT=False</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSIONAUTHOR=Brian</span> <span class=err>Pfeil</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TASKDISPLAYNAME=deploy</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_STAGENAME=__default</span>
</span></span><span class=line><span class=cl><span class=err>VSTS_PROCESS_LOOKUP_ID=vsts_f</span><span class=mf>104e61</span><span class=err>b</span><span class=mi>-5</span><span class=err>db</span><span class=mi>9-493</span><span class=err>c</span><span class=mi>-8204-4</span><span class=err>ffeb</span><span class=mi>8973</span><span class=err>a</span><span class=mi>65</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REPOSITORY_ID=pfeilbr/azure-pipelines-playground</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEVERSIONMESSAGE=output</span> <span class=err>env</span> <span class=err>variables</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM=build</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PHASEATTEMPT=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>VCPKG_INSTALLATION_ROOT=/usr/local/share/vcpkg</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBNAME=__default</span>
</span></span><span class=line><span class=cl><span class=err>REGION=us-east</span><span class=mi>-1</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_PHASEID=</span><span class=mi>3</span><span class=err>a</span><span class=mi>3</span><span class=err>a</span><span class=mi>2</span><span class=err>a</span><span class=mi>60-14</span><span class=err>c</span><span class=mi>7-570</span><span class=err>b</span><span class=mi>-14</span><span class=err>a</span><span class=mi>4</span><span class=err>-fa</span><span class=mi>42</span><span class=err>ad</span><span class=mi>92</span><span class=err>f</span><span class=mi>52</span><span class=err>a</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_MACHINENAME=fv-az</span><span class=mi>755</span>
</span></span><span class=line><span class=cl><span class=err>COMMON_TESTRESULTSDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/TestResults</span>
</span></span><span class=line><span class=cl><span class=err>agent.jobstatus=Succeeded</span>
</span></span><span class=line><span class=cl><span class=err>JAVA_HOME_</span><span class=mi>7</span><span class=err>_X</span><span class=mi>64</span><span class=err>=/usr/lib/jvm/zulu</span><span class=mi>-7</span><span class=err>-azure-amd</span><span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_DEFINITIONNAME=pfeilbr.azure-pipelines-playground</span>
</span></span><span class=line><span class=cl><span class=err>AWS_ACCESS_KEY_ID=AKIAXWO</span><span class=mi>2</span><span class=err>SDPLDE</span><span class=mi>43</span><span class=err>XM</span><span class=mi>4</span><span class=err>W</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_ARTIFACTSDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/a</span>
</span></span><span class=line><span class=cl><span class=err>SHLVL=</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REQUESTEDFORID=</span><span class=mi>5</span><span class=err>d</span><span class=mi>5</span><span class=err>ba</span><span class=mi>760</span><span class=err>-cdcf</span><span class=mi>-6</span><span class=err>c</span><span class=mi>15-8</span><span class=err>d</span><span class=mi>80</span><span class=err>-c</span><span class=mi>37</span><span class=err>de</span><span class=mi>4</span><span class=err>cf</span><span class=mi>7631</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_NAME=Hosted</span> <span class=err>Agent</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_BUILDNUMBER=</span><span class=mf>20200305.5</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCEBRANCHNAME=v</span><span class=mf>0.0</span><span class=err>.</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_JOBDISPLAYNAME=Job</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_SOURCESDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/s</span>
</span></span><span class=line><span class=cl><span class=err>LEIN_JAR=/usr/local/lib/lein/self-installs/leiningen</span><span class=mf>-2.9</span><span class=err>.</span><span class=mi>2</span><span class=err>-standalone.jar</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_BUILDURI=vstfs:</span><span class=c1>///Build/Build/53
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>SYSTEM_SERVERTYPE=Hosted</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TIMELINEID=b</span><span class=mi>5</span><span class=err>cbb</span><span class=mi>7</span><span class=err>c</span><span class=mi>3-6</span><span class=err>a</span><span class=mi>1</span><span class=err>c</span><span class=mi>-4</span><span class=err>c</span><span class=mi>2</span><span class=err>f</span><span class=mi>-85</span><span class=err>da</span><span class=mi>-7</span><span class=err>cd</span><span class=mi>89</span><span class=err>b</span><span class=mi>56</span><span class=err>bfcc</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_RETAINDEFAULTENCODING=</span><span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TASKINSTANCEID=</span><span class=mi>9</span><span class=err>c</span><span class=mf>939e41</span><span class=mi>-62</span><span class=err>c</span><span class=mi>2-5605</span><span class=mf>-5e05</span><span class=err>-fc</span><span class=mi>3554</span><span class=err>afc</span><span class=mi>9</span><span class=err>f</span><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_DEFAULTWORKINGDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/s</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_JOBSTATUS=Succeeded</span>
</span></span><span class=line><span class=cl><span class=err>ANT_HOME=/usr/share/ant</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_REPOSITORY_CLEAN=False</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TEAMPROJECT=project</span><span class=mi>01</span>
</span></span><span class=line><span class=cl><span class=err>PATH=/usr/share/rust/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin</span>
</span></span><span class=line><span class=cl><span class=err>SELENIUM_JAR_PATH=/usr/share/java/selenium-server-standalone.jar</span>
</span></span><span class=line><span class=cl><span class=err>CHROME_BIN=/usr/bin/google-chrome</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_COLLECTIONID=</span><span class=mi>1</span><span class=err>cc</span><span class=mi>55890-46</span><span class=err>d</span><span class=mi>6-40</span><span class=err>c</span><span class=mi>1-9714-8220</span><span class=err>ddd</span><span class=mi>17</span><span class=err>bd</span><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_CONTAINERID=</span><span class=mi>5246219</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_TEAMFOUNDATIONCOLLECTIONURI=https:</span><span class=c1>//dev.azure.com/brianpfeil/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>GIT_TERMINAL_PROMPT=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>AGENT_BUILDDIRECTORY=/home/vsts/work/</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_STAGEID=</span><span class=mi>96</span><span class=err>ac</span><span class=mi>2280-8</span><span class=err>cb</span><span class=mi>4-5</span><span class=err>df</span><span class=mi>5-99</span><span class=err>de-dd</span><span class=mi>2</span><span class=err>da</span><span class=mi>759617</span><span class=err>d</span>
</span></span><span class=line><span class=cl><span class=err>SYSTEM_ENABLEACCESSTOKEN=SecretVariable</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_BINARIESDIRECTORY=/home/vsts/work/</span><span class=mi>1</span><span class=err>/b</span>
</span></span><span class=line><span class=cl><span class=err>BUILD_BUILDID=</span><span class=mi>53</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=p>{</span><span class=err>BUILD_REPOSITORY_URI</span><span class=p>}</span><span class=err>/tree/$</span><span class=p>{</span><span class=err>BUILD_SOURCEBRANCHNAME</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=p>{</span><span class=err>BUILD_REPOSITORY_URI</span><span class=p>}</span><span class=err>/commit/$</span><span class=p>{</span><span class=err>BUILD_SOURCEVERSION</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>athena</span> <span class=err>create</span> <span class=err>table</span> <span class=err>for</span> <span class=err>CloudFront</span> <span class=err>logs</span>
</span></span><span class=line><span class=cl><span class=err>CREATE</span> <span class=err>EXTERNAL</span> <span class=err>TABLE</span> <span class=err>IF</span> <span class=err>NOT</span> <span class=err>EXISTS</span> <span class=err>default.cloudfront_logs_stagingallthecloudbits</span> <span class=err>(</span>
</span></span><span class=line><span class=cl>  <span class=err>`date`</span> <span class=err>DATE,</span>
</span></span><span class=line><span class=cl>  <span class=err>time</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>location</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>bytes</span> <span class=err>BIGINT,</span>
</span></span><span class=line><span class=cl>  <span class=err>request_ip</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>method</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>host</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>uri</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>status</span> <span class=err>INT,</span>
</span></span><span class=line><span class=cl>  <span class=err>referrer</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>user_agent</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>query_string</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>cookie</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>result_type</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>request_id</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>host_header</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>request_protocol</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>request_bytes</span> <span class=err>BIGINT,</span>
</span></span><span class=line><span class=cl>  <span class=err>time_taken</span> <span class=err>FLOAT,</span>
</span></span><span class=line><span class=cl>  <span class=err>xforwarded_for</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>ssl_protocol</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>ssl_cipher</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>response_result_type</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>http_version</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>fle_status</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>fle_encrypted_fields</span> <span class=err>INT,</span>
</span></span><span class=line><span class=cl>  <span class=err>c_port</span> <span class=err>INT,</span>
</span></span><span class=line><span class=cl>  <span class=err>time_to_first_byte</span> <span class=err>FLOAT,</span>
</span></span><span class=line><span class=cl>  <span class=err>x_edge_detailed_result_type</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>sc_content_type</span> <span class=err>STRING,</span>
</span></span><span class=line><span class=cl>  <span class=err>sc_content_len</span> <span class=err>BIGINT,</span>
</span></span><span class=line><span class=cl>  <span class=err>sc_range_start</span> <span class=err>BIGINT,</span>
</span></span><span class=line><span class=cl>  <span class=err>sc_range_end</span> <span class=err>BIGINT</span>
</span></span><span class=line><span class=cl><span class=err>)</span>
</span></span><span class=line><span class=cl><span class=err>ROW</span> <span class=err>FORMAT</span> <span class=err>DELIMITED</span> 
</span></span><span class=line><span class=cl><span class=err>FIELDS</span> <span class=err>TERMINATED</span> <span class=err>BY</span> <span class=err>&#39;\t&#39;</span>
</span></span><span class=line><span class=cl><span class=err>LOCATION</span> <span class=err>&#39;s</span><span class=mi>3</span><span class=err>:</span><span class=c1>//dev-agency-website-cloudfrontlogsbucket-jf9ykpajh7n1/cloudfront/logs/staging.allthecloudbits.com/&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>TBLPROPERTIES</span> <span class=err>(</span> <span class=err>&#39;skip.header.line.count&#39;=&#39;</span><span class=mi>2</span><span class=err>&#39;</span> <span class=err>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>query</span>
</span></span><span class=line><span class=cl><span class=err>SELECT</span> <span class=err>*</span> <span class=err>FROM</span> <span class=s2>&#34;default&#34;</span><span class=err>.</span><span class=s2>&#34;cloudfront_logs_stagingallthecloudbits&#34;</span> <span class=err>limit</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>CF</span> <span class=err>dist</span> <span class=err>WAF</span> <span class=err>association</span> 
</span></span><span class=line><span class=cl><span class=err>myDistribution</span>
</span></span><span class=line><span class=cl>  <span class=err>Type</span> <span class=err>AWS::CloudFront::Distribution</span>
</span></span><span class=line><span class=cl>  <span class=err>Properties:</span>
</span></span><span class=line><span class=cl>    <span class=err>DistributionConfig:</span>
</span></span><span class=line><span class=cl>        <span class=err>WebACLId:</span> <span class=err>!Ref</span> <span class=err>:</span> <span class=err>MyWebACL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>aws</span> <span class=err>managed</span> <span class=err>rule</span> <span class=err>groups</span>
</span></span><span class=line><span class=cl><span class=err>https:</span><span class=c1>//docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-list.html
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=err>AWS::WAFv</span><span class=mi>2</span><span class=err>::WebACL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=err>Type:</span> <span class=err>AWS::WAFv</span><span class=mi>2</span><span class=err>::WebACL</span>
</span></span><span class=line><span class=cl>    <span class=err>Properties:</span>
</span></span><span class=line><span class=cl>      <span class=err>Name:</span> <span class=err>waf-webacl</span>
</span></span><span class=line><span class=cl>      <span class=err>Scope:</span> <span class=err>CLOUDFRONT</span>
</span></span><span class=line><span class=cl>      <span class=err>Description:</span> <span class=err>CloudFront</span> <span class=err>WAF</span> <span class=err>WebACL</span>
</span></span><span class=line><span class=cl>      <span class=err>DefaultAction:</span>
</span></span><span class=line><span class=cl>        <span class=err>Allow:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>      <span class=err>VisibilityConfig:</span>
</span></span><span class=line><span class=cl>        <span class=err>SampledRequestsEnabled:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=err>CloudWatchMetricsEnabled:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=err>MetricName:</span> <span class=err>ExampleWebACLMetric</span>
</span></span><span class=line><span class=cl>      <span class=err>Rules:</span>
</span></span><span class=line><span class=cl>        <span class=err>-</span> <span class=err>Name:</span> <span class=err>RuleWithAWSManagedRules</span>
</span></span><span class=line><span class=cl>          <span class=err>Priority:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=err>OverrideAction:</span>
</span></span><span class=line><span class=cl>            <span class=err>Count:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>          <span class=err>VisibilityConfig:</span>
</span></span><span class=line><span class=cl>            <span class=err>SampledRequestsEnabled:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>            <span class=err>CloudWatchMetricsEnabled:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>            <span class=err>MetricName:</span> <span class=err>RuleWithAWSManagedRulesMetric</span>
</span></span><span class=line><span class=cl>          <span class=err>Statement:</span>
</span></span><span class=line><span class=cl>            <span class=err>ManagedRuleGroupStatement:</span>
</span></span><span class=line><span class=cl>              <span class=err>VendorName:</span> <span class=err>AWS</span>
</span></span><span class=line><span class=cl>              <span class=err>Name:</span> <span class=err>AWSManagedRulesCommonRuleSet</span>
</span></span><span class=line><span class=cl>              <span class=err>ExcludedRules:</span> <span class=p>[]</span>
</span></span></code></pre></div><hr><section id=social-share><div class="list-inline footer-links text-center"><span class=text-muted>share on</span><br><a href="//twitter.com/share?url=https%3a%2f%2fbrianpfeil.com%2fpost%2fazure-pipelines%2f&amp;text=Azure%20Pipelines&amp;via=" target=_blank title="Share on Twitter">Twitter</a>
&nbsp;&bull;&nbsp;
<a href="//reddit.com/submit?url=https%3a%2f%2fbrianpfeil.com%2fpost%2fazure-pipelines%2f&amp;title=Azure%20Pipelines" target=_blank title="Share on Reddit">Reddit</a></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://brianpfeil.com/post/flask/ data-toggle=tooltip data-placement=top title=Flask>&larr; Flask</a></li><li class=next><a href=https://brianpfeil.com/post/react-async/ data-toggle=tooltip data-placement=top title="React Async">React Async &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://twitter.com/pfeilbr title=twitter><span class=footer-link>twitter</span></a></li><li><a href=https://github.com/pfeilbr title=github><span class=footer-link>github</span></a></li><li><a href=https://stackoverflow.com/users/29148/pfeilbr title="stack overflow"><span class=footer-link>stack overflow</span></a></li><li><a href=/index.xml title=RSS><span class=footer-link>rss</span></a></li></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2024</p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://brianpfeil.com/js/main.js></script><script src=https://brianpfeil.com/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://brianpfeil.com/js/load-photoswipe.js></script><script src=https://unpkg.com/darkreader@4.9.16/darkreader.js crossorigin=anonymous></script><script>(()=>{DarkReader.setFetchMethod(window.fetch);const e="DARK_MODE_ENABLED_KEY",n=document.getElementById("dark-mode-enabled-icon"),s=document.getElementById("dark-mode-disabled-icon");if(n===null||s===null)return;const t="hidden",o=()=>{window.localStorage&&(DarkReader.enable({brightness:100,contrast:90,sepia:10}),window.localStorage.setItem(e,"true"),n.classList.add(t),s.classList.remove(t))},i=()=>{window.localStorage&&(DarkReader.disable(),window.localStorage.getItem(e)&&window.localStorage.removeItem(e),n.classList.remove(t),s.classList.add(t))},a=()=>window.localStorage&&window.localStorage.getItem(e)!=null,r=()=>{a()?i():o()};a()?o():i();const c=document.getElementById("dark-mode-toggle");c.addEventListener("click",r)})()</script><script></script><script id=search-result-template type=text/x-js-template>
<article class="post-preview" id="summary-${key}">
    <a class="search-item" href="${link}">
        <h2 class="post-title">${title}</h2>
    </a>

    <p class="post-meta">
        <span class="post-meta">
            ${postedOnDate}
            <span class="blog-tags">
                &nbsp;•&nbsp;
                ${ isset tags }${tags}${ end }
            </span>
        </span>
    </p>
    <div class="post-entry">
    ${snippet}
    </div>
</article>
</script><script>const postCount=296</script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script src=https://brianpfeil.com/js/search.js></script></body></html>