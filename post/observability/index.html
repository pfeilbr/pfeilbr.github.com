<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Observability - Brian Pfeil</title>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Brian Pfeil","url":"https:\/\/brianpfeil.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/brianpfeil.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/brianpfeil.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/brianpfeil.com\/post\/observability\/","name":"Observability"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Brian Pfeil"},"headline":"Observability","description":"","inLanguage":"en","wordCount":1156,"datePublished":"2023-03-03T00:00:00\u002b00:00","dateModified":"2023-03-03T00:00:00\u002b00:00","image":"https:\/\/brianpfeil.com\/","keywords":[""],"mainEntityOfPage":"https:\/\/brianpfeil.com\/post\/observability\/","publisher":{"@type":"Organization","name":"https:\/\/brianpfeil.com\/","logo":{"@type":"ImageObject","url":"https:\/\/brianpfeil.com\/","height":60,"width":60}}}</script><meta property="og:title" content="Observability"><meta property="og:url" content="https://brianpfeil.com/post/observability/"><meta property="og:type" content="website"><meta property="og:site_name" content="Brian Pfeil"><meta name=twitter:title content="Observability"><meta name=twitter:card content="summary_large_image"><meta name=generator content="Hugo 0.124.1"><link rel=alternate href=https://brianpfeil.com/index.xml type=application/rss+xml title="Brian Pfeil"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://brianpfeil.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://brianpfeil.com/css/highlight.min.css><link rel=stylesheet href=https://brianpfeil.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=https://brianpfeil.com/css/custom.css><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-610553-4","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://brianpfeil.com/>Brian Pfeil</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=about href=/about/>about</a></li><li><a title=posts href=/>posts</a></li><li><a title=projects href=/projects/>projects</a></li><li><a title=tags href=/tags/>tags</a></li><li><a id=dark-mode-toggle><i class="fa fa-moon hidden" id=dark-mode-enabled-icon aria-hidden=true></i>
<i class="fa fa-sun hidden" id=dark-mode-disabled-icon aria-hidden=true></i></a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Observability</h1><span class=post-meta>March 3, 2023</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><div class="alert alert-info small bg-info" role=alert><span class=text-muted>code for article</span>&nbsp;<a href=https://github.com/pfeilbr/observability-playground target=_blank><i class="fab fa-github fa-sm"></i>&nbsp;pfeilbr/observability-playground</a></div><ul><li>observability (o11y for short)</li><li>definition of “observability” for software systems is a measure of how well you can understand and explain any state your system can get into</li><li>If you can understand any bizarre or novel state without needing to ship new code, you have observability.</li><li>observability is more relevant in the age of micro services and solutions being composed of many disparate services. not as important in the age of the monolith, where everything happened in a single process + options DB and all the information was available in a single log.</li><li>Observability lets you easily deal with unknown unknowns</li></ul><blockquote><p>“You can understand the inner workings of a system […] by asking questions from the outside […], without having to ship new code every time. It’s easy to ship new code to answer a specific question that you found that you need to ask. But instrumenting so that you can ask any question and understand any answer is both an art and a science, and your system is observable when you can ask any question of your system and understand the results without having to SSH into a machine.”</p></blockquote><h2 id=concepts>concepts</h2><ul><li>telemetry - refers to data emitted from a system</li><li><a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md>OTLP (OpenTelemetry Protocol)</a></li><li>monitoring - is inherently reactive. traditional monitoring tools work by checking system conditions against known thresholds that indicate whether previously known error conditions are present</li><li>metrics - aggregations over a period of time of numeric data about your infrastructure or application. e.g. system error rate, CPU utilization, request rate for a given service.<ul><li>metics require you to define them upfront. if there is an issue that you can&rsquo;t answer with your pre-defined metrics, you need to add the metric, and try to re-create the problem to populate the new metric.</li><li>Metrics require foresight into what’s going to happen later on.</li></ul></li><li>SLA (service level agreement) - commitment between a service provider and a customer</li><li>SLI (Service Level Indicator) - actual measurement of a service’s behavior. A good SLI measures your service from the perspective of your users. e.g. the speed at which a web page loads.</li><li>SLO (Service Level Objective) - means by which reliability is communicated to an organization/other teams. This is accomplished by attaching one or more SLIs to business value.</li></ul><blockquote><p>An SLI (service level indicator) measures compliance with an SLO (service level objective). So, for example, if your SLA specifies that your systems will be available 99.95% of the time, your SLO is likely 99.95% uptime and your SLI is the actual measurement of your uptime. Maybe it&rsquo;s 99.96%. Maybe 99.99%.</p></blockquote><ul><li><p>trace (aka distributed traces) - made up of a tree of spans, starting with a root span, which encapsulates the end-to-end time that it takes to accomplish a task</p></li><li><p>span - represents a unit of work</p></li><li><p>APM - Application Performance Monitoring. monitoring and management of the performance and availability of software applications. APM strives to detect and diagnose complex application performance problems to maintain an expected level of service.</p></li></ul><h2 id=opentelemetry>OpenTelemetry</h2><ul><li>OpenTelemetry (OTel for short)</li><li>API -The specification portion of OTel libraries that allows developers to add instrumentation to their code without concern for the underlying implementation.</li><li>SDK - The concrete implementation component of OTel that tracks state and batches data for transmission.</li><li>Tracer - A component within the SDK that is responsible for tracking which span is currently active in your process. It also allows you to access and modify the current span to perform operations like adding attributes, events, or finishing it when the work it tracks is complete.</li><li>Meter - A component within the SDK that is responsible for tracking which metrics are available to report on in your process. It also allows you to access and modify the current metrics to perform operations like adding values, or retrieving those values at periodic intervals.</li><li>Exporter - plug-in for the SDK that translates OTel in-memory objects into the appropriate format for delivery to a specific destination</li><li>Collector - standalone binary process that can be run as a proxy or sidecar that receives telemetry data (by default in OTLP format), processes it, and tees it to one or more configured destinations.<ul><li>Agent: A Collector instance running with the application or on the same host as the application (e.g. binary, sidecar, or daemonset).
-Gateway: One or more Collector instances running as a standalone service (e.g. container or deployment) typically per cluster, data center or region.</li></ul></li></ul><h2 id=grafana>Grafana</h2><ul><li>web ui for dashboarding</li><li>process - select data sources, write queries against them in promql, influx query</li></ul><h2 id=prometheus>Prometheus</h2><ul><li>typically used to monitor containers, micro services, and traditional servers</li><li>originally built at SoundCloud in 2012</li><li>exporters typically run on the monitored host to export local metrics<ul><li>prometheus server pulls exported via <a href=http://hostaddress/metrics>http://hostaddress/metrics</a> by default</li><li>there are client libraries that allow you to expose your own <code>/metrics</code> endpoint with your custom metrics for custom applications</li></ul></li><li><code>prometheus.yml</code> - specifies the targets to scrape and what interval</li><li>Prometheus data store to centralize and store the metrics</li><li>time series are built through a pull model: the Prometheus server queries a list of data sources (sometimes called exporters) at a specific polling frequency.</li><li>Alertmanager to trigger alerts based on those metrics.<ul><li>Configuration for alerts can be specified in Prometheus which specifies a condition that needs to be maintained for a specific duration in order for an alert to trigger. When alerts trigger, they are forwarded to the Alertmanager service. Alertmanager can include logic to silence alerts and also to forward them to email, Slack, or notification services such as PagerDuty</li></ul></li><li>PromQL is the query language used to create dashboards and alerts.<ul><li>Prometheus server exposes HTTP interface for PromQL queries</li></ul></li><li>Prometheus Web UI<ul><li>run PromQL queries and see results</li><li>simple visualizations (use graphana for more complex)</li></ul></li></ul><h3 id=prometheus-server-architecture>Prometheus Server Architecture</h3><p><img src=https://prometheus.io/assets/architecture.png alt=Architecture></p><p><img src=https://www.evernote.com/l/AAFumws8BphBgIacEtdebi8RtHEkWvGNozQB/image.png alt="Prometheus Server Architecture"></p><p><img src=https://www.evernote.com/l/AAFz2jsYwEZOnqFFKE5n_qOtaFN5ZuhearYB/image.png alt="Collecting Metrics Data from Targets"></p><p><img src=https://www.evernote.com/l/AAFvcfc1LGdOjqG-CzynYfKIvIxFN8zhpSwB/image.png alt="Target Endpoints and Exporters"></p><p><img src=https://www.evernote.com/l/AAGqafVqe3FA045-ITnQbfNaENIXHV6GGNkB/image.png alt="example prometheus.yml"></p><h3 id=prometheus-metric-format>Prometheus metric format</h3><p>A metric is composed by several fields:</p><ul><li>Metric name</li><li>Any number of labels (can be 0), represented as a key-value array</li><li>Current metric value</li><li>Optional metric timestamp</li></ul><p>Metric output is typically preceded with # HELP and # TYPE metadata lines.</p><p>The HELP string identifies the metric name and a brief description of it. The TYPE string identifies the type of metric.</p><p><strong>example metric</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># HELP metric_name Description of the metric
</span></span><span class=line><span class=cl># TYPE metric_name type
</span></span><span class=line><span class=cl># Comment that&#39;s not parsed by prometheus
</span></span><span class=line><span class=cl>http_requests_total{method=&#34;post&#34;,code=&#34;400&#34;}  3   1395066363000
</span></span></code></pre></div><p>Prometheus metrics / OpenMetrics types</p><ul><li>Counter - represents a cumulative metric that only increases over time, like the number of requests to an endpoint.</li><li>Gauge - Gauges are instantaneous measurements of a value. They can be arbitrary values which will be recorded. Gauges represent a random value that can increase and decrease randomly such as the load of your system.</li><li>Histogram - samples observations (usually things like request durations or response sizes) and counts them in configurable buckets. It also provides a sum of all observed values.</li></ul><hr><h2 id=observability-platforms>observability platforms</h2><ul><li>aws x-ray</li><li>honeycomb</li><li>lightstep</li><li>grafana</li><li>splunk</li><li>dynatrace</li></ul><h2 id=resources>resources</h2><ul><li><a href=http://opentelemetry.io/>http://opentelemetry.io/</a></li><li><a href=https://opentelemetry.io/docs/>OpenTelemetry | Documentation</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md>OTLP (OpenTelemetry Protocol)</a></li><li><a href="https://www.youtube.com/watch?v=h4Sl21AKiDg">Youtube: How Prometheus Monitoring works | Prometheus Architecture explained</a></li></ul><hr><section id=social-share><div class="list-inline footer-links text-center"><span class=text-muted>share on</span><br><a href="//twitter.com/share?url=https%3a%2f%2fbrianpfeil.com%2fpost%2fobservability%2f&amp;text=Observability&amp;via=" target=_blank title="Share on Twitter">Twitter</a>
&nbsp;&bull;&nbsp;
<a href="//reddit.com/submit?url=https%3a%2f%2fbrianpfeil.com%2fpost%2fobservability%2f&amp;title=Observability" target=_blank title="Share on Reddit">Reddit</a></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://brianpfeil.com/post/helm/ data-toggle=tooltip data-placement=top title=Helm>&larr; Helm</a></li><li class=next><a href=https://brianpfeil.com/post/openai-nodejs/ data-toggle=tooltip data-placement=top title="OpenAI Nodejs">OpenAI Nodejs &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://twitter.com/pfeilbr title=twitter><span class=footer-link>twitter</span></a></li><li><a href=https://github.com/pfeilbr title=github><span class=footer-link>github</span></a></li><li><a href=https://stackoverflow.com/users/29148/pfeilbr title="stack overflow"><span class=footer-link>stack overflow</span></a></li><li><a href=/index.xml title=RSS><span class=footer-link>rss</span></a></li></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2024</p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://brianpfeil.com/js/main.js></script><script src=https://brianpfeil.com/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://brianpfeil.com/js/load-photoswipe.js></script><script src=https://unpkg.com/darkreader@4.9.16/darkreader.js crossorigin=anonymous></script><script>(()=>{DarkReader.setFetchMethod(window.fetch);const e="DARK_MODE_ENABLED_KEY",n=document.getElementById("dark-mode-enabled-icon"),s=document.getElementById("dark-mode-disabled-icon");if(n===null||s===null)return;const t="hidden",o=()=>{window.localStorage&&(DarkReader.enable({brightness:100,contrast:90,sepia:10}),window.localStorage.setItem(e,"true"),n.classList.add(t),s.classList.remove(t))},i=()=>{window.localStorage&&(DarkReader.disable(),window.localStorage.getItem(e)&&window.localStorage.removeItem(e),n.classList.remove(t),s.classList.add(t))},a=()=>window.localStorage&&window.localStorage.getItem(e)!=null,r=()=>{a()?i():o()};a()?o():i();const c=document.getElementById("dark-mode-toggle");c.addEventListener("click",r)})()</script><script></script><script id=search-result-template type=text/x-js-template>
<article class="post-preview" id="summary-${key}">
    <a class="search-item" href="${link}">
        <h2 class="post-title">${title}</h2>
    </a>

    <p class="post-meta">
        <span class="post-meta">
            ${postedOnDate}
            <span class="blog-tags">
                &nbsp;•&nbsp;
                ${ isset tags }${tags}${ end }
            </span>
        </span>
    </p>
    <div class="post-entry">
    ${snippet}
    </div>
</article>
</script><script>const postCount=296</script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script src=https://brianpfeil.com/js/search.js></script></body></html>