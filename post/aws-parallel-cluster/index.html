<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>AWS Parallel Cluster - Brian Pfeil</title>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Brian Pfeil","url":"https:\/\/brianpfeil.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/brianpfeil.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/brianpfeil.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/brianpfeil.com\/post\/aws-parallel-cluster\/","name":"Aws parallel cluster"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Brian Pfeil"},"headline":"AWS Parallel Cluster","description":"","inLanguage":"en","wordCount":422,"datePublished":"2022-05-22T00:00:00\u002b00:00","dateModified":"2022-05-22T00:00:00\u002b00:00","image":"https:\/\/brianpfeil.com\/","keywords":["aws, hpc"],"mainEntityOfPage":"https:\/\/brianpfeil.com\/post\/aws-parallel-cluster\/","publisher":{"@type":"Organization","name":"https:\/\/brianpfeil.com\/","logo":{"@type":"ImageObject","url":"https:\/\/brianpfeil.com\/","height":60,"width":60}}}</script><meta property="og:title" content="AWS Parallel Cluster"><meta property="og:url" content="https://brianpfeil.com/post/aws-parallel-cluster/"><meta property="og:type" content="website"><meta property="og:site_name" content="Brian Pfeil"><meta name=twitter:title content="AWS Parallel Cluster"><meta name=twitter:card content="summary_large_image"><meta name=generator content="Hugo 0.124.1"><link rel=alternate href=https://brianpfeil.com/index.xml type=application/rss+xml title="Brian Pfeil"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://brianpfeil.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://brianpfeil.com/css/highlight.min.css><link rel=stylesheet href=https://brianpfeil.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=https://brianpfeil.com/css/custom.css><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-610553-4","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://brianpfeil.com/>Brian Pfeil</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=about href=/about/>about</a></li><li><a title=posts href=/>posts</a></li><li><a title=projects href=/projects/>projects</a></li><li><a title=tags href=/tags/>tags</a></li><li><a id=dark-mode-toggle><i class="fa fa-moon hidden" id=dark-mode-enabled-icon aria-hidden=true></i>
<i class="fa fa-sun hidden" id=dark-mode-disabled-icon aria-hidden=true></i></a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>AWS Parallel Cluster</h1><span class=post-meta>May 22, 2022
<span class=blog-tags>&nbsp;&bull;&nbsp;
<a href=https://brianpfeil.com//tags/aws/>aws</a>
,
<a href=https://brianpfeil.com//tags/hpc/>hpc</a></span></span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><div class="alert alert-info small bg-info" role=alert><span class=text-muted>code for article</span>&nbsp;<a href=https://github.com/pfeilbr/aws-parallel-cluster-playground target=_blank><i class="fab fa-github fa-sm"></i>&nbsp;pfeilbr/aws-parallel-cluster-playground</a></div><p>learn <a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/what-is-aws-parallelcluster.html>AWS ParallelCluster</a>. formerly CfnCluster (“cloud formation cluster”)</p><blockquote><p>framework that deploys and maintains high performance computing clusters on Amazon Web Services (AWS). Developed by AWS, CfnCluster facilitates both quick start proof of concepts (POCs) and production deployments. CfnCluster supports many different types of clustered applications and can easily be extended to support different frameworks.</p></blockquote><h2 id=notes>Notes</h2><ul><li>distributed as a Python package and is installed using the Python pip package manager.</li><li>supports <a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/slurm-workload-manager-v3.html>Slurm</a> and <a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/awsbatchcli-v3.html>AWS Batch</a> schedulers</li><li>generates CloudFormation to create the cluster resources<ul><li>CDK is used to generate templates</li></ul></li><li>head node - responsible for submitting and scheduling jobs</li><li>compute node(s) - runs jobs</li><li>AMI for head and compute nodes (ec2 instances)<ul><li>AMI Name: aws-parallelcluster-3.1.4-amzn2-hvm-x86_64-202205121006 2022-05-12T10-09-45.467Z</li><li>AMI Locaiton: amazon/aws-parallelcluster-3.1.4-amzn2-hvm-x86_64-202205121006 2022-05-12T10-09-45.467Z</li></ul></li><li>When you use the awsbatch scheduler, the AWS ParallelCluster CLI commands for AWS Batch are automatically installed in the AWS ParallelCluster head node<ul><li><a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/awsbatchcli-v3.html>CLI commands for AWS Batch</a> - e.g. awsbsub, awsbqueues, etc.</li></ul></li></ul><h2 id=demo>Demo</h2><p>install, configure cluster, create cluster, submit job to cluster</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>python3 -m pip install <span class=s2>&#34;aws-parallelcluster&#34;</span> --upgrade --user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># verify install</span>
</span></span><span class=line><span class=cl>pcluster version
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># configure cluster. prompts for scheduler type, region, etc.</span>
</span></span><span class=line><span class=cl><span class=c1># when done `hello-world.yaml` is created</span>
</span></span><span class=line><span class=cl><span class=c1># and it creates the networking / vpc resources via a cfn stack (e.g. `parallelclusternetworking-pubpriv-20220522231401` stack)</span>
</span></span><span class=line><span class=cl><span class=c1># &lt;https://github.com/aws/aws-parallelcluster/tree/release-3.0/cli/tests/pcluster/example_configs&gt; for example</span>
</span></span><span class=line><span class=cl><span class=c1># cluster configuration files</span>
</span></span><span class=line><span class=cl><span class=c1># &lt;https://docs.aws.amazon.com/parallelcluster/latest/ug/cluster-configuration-file-v3.html&gt; - configuration files spec</span>
</span></span><span class=line><span class=cl>pcluster configure --config hello-world.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create / provision the cluster (the networking/vpc resources already exist from previous `configure` command)</span>
</span></span><span class=line><span class=cl>pcluster create-cluster --cluster-name hello-world --cluster-configuration hello-world.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># login to cluster head node</span>
</span></span><span class=line><span class=cl>pcluster ssh --cluster-name hello-world -i /path/to/keyfile.pem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># run the command sinfo to verify that your compute nodes are set up and configured.</span>
</span></span><span class=line><span class=cl>sinfo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create job to run (hello-job.sh)</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt; hello-job.sh
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>sleep 30
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;Hello World from $(hostname)&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># submit job</span>
</span></span><span class=line><span class=cl><span class=c1># this will create and ec2 compute instance on the fly</span>
</span></span><span class=line><span class=cl>sbatch hello-job.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># view job in job queue</span>
</span></span><span class=line><span class=cl>squeue
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># once no job in queue a `.out` file will be created with results (STDOUT)</span>
</span></span><span class=line><span class=cl>cat slurm-1.out
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># clean up</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># delete cluster compute nodes (this doesn&#39;t delete cluster head node)</span>
</span></span><span class=line><span class=cl>pcluster delete-cluster-instances --cluster-name hello-world
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># delete the cluster itself</span>
</span></span><span class=line><span class=cl><span class=c1># this terminates the head node and delete the cfn stack used to create the cluster</span>
</span></span><span class=line><span class=cl>pcluster delete-cluster --cluster-name hello-world
</span></span></code></pre></div><h2 id=screenshots>Screenshots</h2><h3 id=ec2-instances>EC2 instances</h3><p><img src=ec2-instances.png alt></p><h2 id=resources>Resources</h2><ul><li><a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/what-is-aws-parallelcluster.html>AWS ParallelCluster</a></li><li><a href=https://github.com/aws/aws-parallelcluster>aws/aws-parallelcluster</a></li><li><a href=https://cfncluster.readthedocs.io/en/latest/>cfncluster.readthedocs.io</a></li><li><a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/aws-services-v3.html>AWS services used by AWS ParallelCluster</a></li><li><a href=https://cfncluster.readthedocs.io/en/latest/aws_services.html#aws-services>AWS Services used in CfnCluster</a></li><li><a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/tutorials-running-your-first-job-on-version-3.html>Running your first job on AWS ParallelCluster</a></li><li><a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/cluster-configuration-file-v3.html>Cluster configuration file</a></li><li><a href=https://github.com/aws/aws-parallelcluster/tree/release-3.0/cli/tests/pcluster/example_configs>aws-parallelcluster/cli/tests/pcluster/example_configs/</a> - example cluster configuration files</li><li><a href=https://docs.aws.amazon.com/parallelcluster/latest/ug/commands-v3.html>AWS ParallelCluster CLI commands</a></li><li><a href=https://slurm.schedmd.com/documentation.html>Slurm Workload Manager - Documentation</a></li></ul><hr><section id=social-share><div class="list-inline footer-links text-center"><span class=text-muted>share on</span><br><a href="//twitter.com/share?url=https%3a%2f%2fbrianpfeil.com%2fpost%2faws-parallel-cluster%2f&amp;text=AWS%20Parallel%20Cluster&amp;via=pfeilbr" target=_blank title="Share on Twitter">Twitter</a>
&nbsp;&bull;&nbsp;
<a href="//reddit.com/submit?url=https%3a%2f%2fbrianpfeil.com%2fpost%2faws-parallel-cluster%2f&amp;title=AWS%20Parallel%20Cluster" target=_blank title="Share on Reddit">Reddit</a></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://brianpfeil.com/post/aws-web-content/ data-toggle=tooltip data-placement=top title="AWS Web Content">&larr; AWS Web Content</a></li><li class=next><a href=https://brianpfeil.com/post/ec2-image-builder/ data-toggle=tooltip data-placement=top title="EC2 Image Builder">EC2 Image Builder &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://twitter.com/pfeilbr title=twitter><span class=footer-link>twitter</span></a></li><li><a href=https://github.com/pfeilbr title=github><span class=footer-link>github</span></a></li><li><a href=https://stackoverflow.com/users/29148/pfeilbr title="stack overflow"><span class=footer-link>stack overflow</span></a></li><li><a href=/index.xml title=RSS><span class=footer-link>rss</span></a></li></ul><p class="credits copyright text-muted"><a href=https://brianpfeil.com>Brian Pfeil</a>
&nbsp;&bull;&nbsp;&copy;
2024</p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://brianpfeil.com/js/main.js></script><script src=https://brianpfeil.com/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://brianpfeil.com/js/load-photoswipe.js></script><script src=https://unpkg.com/darkreader@4.9.16/darkreader.js crossorigin=anonymous></script><script>(()=>{DarkReader.setFetchMethod(window.fetch);const e="DARK_MODE_ENABLED_KEY",n=document.getElementById("dark-mode-enabled-icon"),s=document.getElementById("dark-mode-disabled-icon");if(n===null||s===null)return;const t="hidden",o=()=>{window.localStorage&&(DarkReader.enable({brightness:100,contrast:90,sepia:10}),window.localStorage.setItem(e,"true"),n.classList.add(t),s.classList.remove(t))},i=()=>{window.localStorage&&(DarkReader.disable(),window.localStorage.getItem(e)&&window.localStorage.removeItem(e),n.classList.remove(t),s.classList.add(t))},a=()=>window.localStorage&&window.localStorage.getItem(e)!=null,r=()=>{a()?i():o()};a()?o():i();const c=document.getElementById("dark-mode-toggle");c.addEventListener("click",r)})()</script><script></script><script id=search-result-template type=text/x-js-template>
<article class="post-preview" id="summary-${key}">
    <a class="search-item" href="${link}">
        <h2 class="post-title">${title}</h2>
    </a>

    <p class="post-meta">
        <span class="post-meta">
            ${postedOnDate}
            <span class="blog-tags">
                &nbsp;•&nbsp;
                ${ isset tags }${tags}${ end }
            </span>
        </span>
    </p>
    <div class="post-entry">
    ${snippet}
    </div>
</article>
</script><script>const postCount=296</script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script src=https://brianpfeil.com/js/search.js></script></body></html>